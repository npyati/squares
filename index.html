<!--
Squares
Made by NP, Jan. 2021 - ongoing
...except for Google Web Fonts and jQuery:

Hosted on GitHub Pages

- https://jquery.com/
- https://fonts.google.com/
-- Logo in Alfa Slab One by JM SolÃ©

  -->

<!--Graphics to pull in. Check mark and x -->
<!DOCTYPE html>
<html lang="en">
  <script id='svg_x'>

    <svg x=0% y=0% width=0% height=0% id='new_x' viewBox="0 0 1000 1000"
     preserveAspectRatio="xMidYMid meet">

    <g transform="translate(0.000000,0) scale(0.310000,0.3100000)"
    fill="#3B393A" stroke="none">
    <path d="M240 2989 c-68 -39 -101 -119 -81 -195 9 -34 96 -126 596 -624 322
    -321 585 -589 585 -595 0 -6 -288 -298 -641 -650 -352 -352 -647 -652 -655
    -667 -18 -34 -18 -109 0 -152 29 -69 115 -108 203 -92 34 7 109 79 688 657
    358 357 655 649 660 649 6 0 298 -288 650 -641 352 -352 652 -647 667 -655 15
    -8 48 -14 74 -14 126 0 210 130 155 242 -14 30 -211 234 -661 683 l-640 640
    589 590 c524 524 590 594 597 628 22 123 -49 217 -163 217 -30 0 -66 -6 -81
    -14 -15 -8 -288 -276 -607 -595 l-580 -581 -580 579 c-319 318 -594 586 -612
    595 -45 22 -120 20 -163 -5z"/>
    </g>
    </svg>

  </script>
  
  <script id='svg_check'>

    <svg x=0% y=0% width=0% height=0% id='new_x' viewBox="0 0 1200 1000"
     preserveAspectRatio="xMidYMid meet">

     <g transform="translate(-30.00,1000) scale(0.5000,-0.50000)"
     fill="#3B393A" stroke="none">
     <path d="M1679 1074 l-749 -749 -363 362 c-199 198 -372 366 -384 372 -83 42
     -179 -34 -155 -122 7 -24 882 -917 899 -917 5 0 376 368 825 818 642 642 818
     824 823 848 7 35 -12 91 -38 113 -10 7 -38 16 -63 19 l-46 5 -749 -749z"/>
     </g>
    </svg>

  </script>
  
  <script id="svg_new">
    <svg x="0px" y="0px" viewBox="0 0 1000 1000">
      <g transform="translate(300.00,10) scale(0.3000,0.30000)">
      <path d="M884.3,490.4c-31.8,0-57.6,25.8-57.6,57.6c0,180.1-146.5,326.7-326.7,326.7S173.3,728.1,173.3,548S319.9,221.4,500,221.4h0.1v96.1l230.6-153.7L500.1,10v96.1H500C256.3,106.1,58,304.3,58,548c0,243.8,198.3,442,442,442s442-198.2,442-442C942,516.2,916.2,490.4,884.3,490.4"/></g>
    </svg>
  </script>
<head>
  <meta charset="utf-8" />
  <title>squares</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=3">




  <!-- <meta name="viewport"
    content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" /> -->
  <meta name="description" content="a game of squares" />
  <meta name="theme-color" content="#3b393a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="squares" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  <script type="module" src="https://unpkg.com/@fluentui/web-components" crossorigin="anonymous"></script>
  <!-- TypeScript module removed for static hosting -->

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap');
  </style>

<style media="screen">:root{--sq-white:#ffffe7;--sq-green:#2eccb2;--sq-trans-green:rgba(46,204,178,.322);--sq-grey:#3b393a;--sq-trans-grey:#3b393ad6;--sq-light-grey:#ffffff42;--sq-red:#fe4b72;--sq-trans-red:#fe4b72ab;--sq-yellow:#fdde4e;--sq-purple:#7f63ac;--sq-blue:#52a9d4;--sq-pink:#ff8eac;--sq-orange:#f96}@media (hover:hover) and (pointer:fine){.box:hover{opacity:.5}}.box{cursor:pointer}#gameboard{cursor:pointer}.title{font-family:'Roboto',sans-serif;font-size:200%}a:link{font-family:'Roboto',sans-serif;text-decoration:none}.logo{font-family:'Alfa Slab One','Roboto',sans-serif;font-size:200%}body{background-color:var(--sq-grey);color:var(--sq-white);font-family:'Roboto',sans-serif;font-size:100%}hr{border:1px solid var(--sq-light-grey);margin:0}.table{display:table;width:100%;position:relative}.row{display:table-row;padding:10px 0}.cell{display:table-cell}#overlay{position:absolute;left:0;top:0;width:100%;height:100%;background-color:var(--sq-grey);z-index:2;opacity:70%;display:none}
  #popup{position:absolute;z-index:10;background-color:var(--sq-trans-grey);box-shadow:0px 0px 50px 2px #000;color:var(--sq-white);overflow-y:auto;border-radius:5px;display:none}#container{position:absolute}#controls{position:absolute;width:100%;margin-top:30px}.panel{position:absolute;align-items:center;justify-content:center;display:flex;height:100%}.center_button{width:100%;height:100%;cursor:pointer;align-items:center;justify-content:center;display:flex;border-radius:10px;font-weight:700;font-size:120%;background-color:var(--sq-light-grey)}#import_button_container{display:flex;width:100%;height:50px;align-items:center;justify-content:center;margin-top:10px}#import_button{cursor:pointer;align-items:center;justify-content:center;display:flex;border-radius:10px;font-weight:700;font-size:120%;padding:5px;background-color:var(--sq-light-grey)}.engage{background-color:var(--sq-green);color:var(--sq-grey)}.side_button{width:100%;height:100%;cursor:pointer;align-items:center;justify-content:center;display:flex;border-radius:5px;font-weight:700;font-size:100%}
  #non-board{position:absolute;width:100%;z-index:1}#level_text{display:none;position:absolute;border-radius:10px;padding:10px 10px 0;font-size:100%;margin:0}.number_text{fill:var(--sq-grey);font:bold 120% sans-serif}.label_text{fill:var(--sq-grey);font:bold 100% sans-serif}.text_120{font:bold 120% sans-serif}a{color:#fff;font-family:"Roboto",sans;font-size:100%}#explain_panel{position:absolute;width:100%;top:20px;background-color:var(--sq-grey);box-shadow:0px 0px 50px 2px #000;border-radius:5px;padding:10px;display:none;z-index:5}#explain_left,#explain_right{width:50%}#explain_menu{text-align:center;font-weight:700;font-size:120%;cursor:pointer;align-items:center;justify-content:center;display:flex;padding-top:10px;padding-bottom:10px}.explain_link{cursor:pointer;font-weight:700}#rules{position:absolute;width:100%;align-items:center;justify-content:center;display:flex}.rules_dot{cursor:pointer}#logo_svg,#logo_green,#logo_red{display:none}#logo{position:relative}#info_bar{position:absolute;width:98%;text-align:center}
  .heading{font-size:120%;font-weight:700;color:var(--sq-blue)}.difficulty_button{width:100%;align-items:center;justify-content:center;display:flex;font-family:'Roboto',sans-serif;font-size:150%;color:var(--sq-grey);border-radius:5px;margin-bottom:2%;cursor:pointer;color:var(--sq-grey)}.menu_row{width:100%;border:0 solid var(--sq-grey);margin:0;align-items:center;justify-content:left;display:flex;font-family:'Roboto',sans-serif;font-size:100%;padding:6% 0;cursor:pointer;position:relative}.stat{position:absolute;right:0}.menu_item{justify-content:center;font-size:130%}.date{width:45%}.history_status{width:30%}.freq_slider{position:absolute;right:0}.daily{background-color:var(--sq-white)}.beginner{background-color:var(--sq-green)}.easy{background-color:var(--sq-blue)}.medium{background-color:var(--sq-purple)}.hard{background-color:var(--sq-orange)}.painful{background-color:var(--sq-red)}.ui_button{align-items:center;justify-content:center;display:inline-flex;cursor:pointer;color:var(--sq-white);font-size:120%}
  .text_button{cursor:pointer}a{color:var(--sq-white)}.text_button:hover{color:var(--sq-green)}.back_to_menu{color:var(--sq-red)}.div_button{color:var(--sq-white);text-align:center;position:absolute;cursor:pointer}.popup_heading{position:absolute;align-items:center;justify-content:center;display:flex;left:0;width:100%;margin-bottom:10px;border-bottom:2px solid var(--sq-grey)}#popup_content{margin:0;padding:10px;position:relative;height:100%;align-items:center;justify-content:center}.tiny_board{position:absolute}.tiny_container{margin:0;padding:0}.tiny_overlay{position:absolute;font-family:'Alfa Slab One','Roboto',sans-serif;font-size:150%;color:var(--sq-grey);background-color:var(--sq-trans-green);align-items:center;justify-content:center;display:flex;z-index:5}.level_menu_item,.history_menu_item,.daily_menu_item{width:100%;position:relative;display:flex;align-items:center;cursor:pointer}.daily_menu_item,.history_menu_item{font-size:85%}.indicator{display:none;position:relative}
  .incorrect{font-weight:700;color:#fe4b72}.correct{font-weight:700;color:var(--sq-green)}.type_0{background-color:var(--sq-white);fill:var(--sq-white)}.text_0{color:var(--sq-white)}.text_00{color:var(--sq-white)}.type_1{background-color:#fe4b72;fill:var(--sq-red)}.text_1{color:var(--sq-red)}.type_2{background-color:var(--sq-green);fill:var(--sq-green)}.text_2{color:var(--sq-green)}.type_3{background-color:var(--sq-yellow);fill:var(--sq-yellow)}.text_3{color:var(--sq-yellow)}.type_4{background-color:var(--sq-purple);fill:var(--sq-purple)}.text_4{color:var(--sq-purple)}.type_5{background-color:var(--sq-blue);fill:var(--sq-blue)}.text_5{color:var(--sq-blue)}.type_6{background-color:var(--sq-pink);fill:var(--sq-pink)}.text_6{color:var(--sq-pink)}.type_8{background-color:var(--sq-orange);fill:var(--sq-orange)}.text_8{color:var(--sq-orange)}.checkbox{border:2px solid var(--sq-white);display:inline-block;position:absolute;right:0;width:20px;height:20px;margin:0}#import_box{height:200px;overflow-x:hidden;overflow-y:hidden}
  #import_text{resize:none;width:100%;height:100%}#prev{width:50%;font-size:100%;text-align:center}#next{width:50%;font-size:100%;border-left:1px solid var(--sq-grey);text-align:center}.select{position:absolute;right:0}.checked{background-color:var(--sq-green)}</style>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script type="text/javascript">
    
    var solutions, pairs, guess_counter, corrects, guesses = [];
    const favorite = "4060135826211500",
        precedence = {
            3: 1,
            7: 1,
            4: 2,
            5: 3,
            6: 5,
            8: 4,
            9: 4
        },
        flip_table = {
            1: 2,
            2: 1,
            3: 7,
            7: 3,
            4: 5,
            5: 4,
            8: 9,
            9: 8
        },
        behavior_types = [3, 4, 5, 6, 7, 8, 9],
        solution_types = [1, 2];
    var edit = 0,
        explain = 0,
        levels = 0,
        level_pos = {
            pack: 0,
            step: 0
        },
        popup_size = "large";
    const preset_lib = {
            1: [5, 7, 4, 0, 0, 0, 0, 0, 0],
            2: [4, 7, 4, 4, 0, 0, 0, 0, 0],
            3: [5, 4, 0, 0, 4, 0, 0, 0, 0],
            4: [8, 4, 2, 3, 3, 4, 0, 0, 0],
            5: [5, 4, 2, 3, 3, 4, 2, 0, 1],
            6: [2, 5, 0, 6, 6, 6, 5, 0, 3],
            7: [6, 4, 4, 3, 4, 3, 2, 0, 2]
        },
        rules_text = {
            0: "<p><strong>White squares</strong></p><p>White squares can be solutions, but don't affect other squares.</p>",
            1: "<p><span class='text_1'><strong>Red squares</strong></span></p><p>Solutions must touch more green squares than red squares.</p><p>If no square touches more green than red, then any square that touches the <i>same</i> number of greens and reds is a solution.</p>",
            2: "<p><span class='text_2'><strong>Green squares</strong></span></p><p>Solutions must touch more green squares than red squares.</p><p>If no square touches more green than red, then any square that touches the <i>same</i> number of greens and reds is a solution.</p>",
            3: "<p><span class='text_3'><strong>Yellow squares</strong></span></p><p>Any square touching a yellow squares loses its effect and acts like a white square.</p><p>If two or more yellows touch in a group, they all turn each other off.</p>",
            4: "<p><span class='text_4'><strong>Purple squares</strong></span></p><p>Purples \"extend\" the squares they touch, so they act like they touch every square in their rows and columns.</p><p>Purple beats yellow.</p>",
            5: "<p><span class='text_5'><strong>Blue squares</strong></span></p><p>A square touching a blue square acts like it touches itself.</p><p>A yellow square that touches itself turns itself off. A purple square that touches itself extends itself. An orange square that touches itself now touches the squares at its corners, not its sides.</p><p>Blue beats purple and yellow.</p>",
            8: "<p><span class='text_8'><strong>Orange squares</strong></span></p><p>An orange makes the squares it touches touch their corners, not their sides. If those squares are extended, they touch everything in their diagonals instead of their rows and columns.</p><p>If orange squares touch one another, they all touch their corners instead of their sides.</p><p>Orange beats blue, purple, and yellow.</p>",
            6: "<p><span class='text_6'><strong>Pink squares</strong></span></p><p>Pinks reverse the squares they touch. Green squares act as red squares, and red as green. Blue squares act as purple squares, and purple as blue. Yellow squares now turn other squares back on if they've been turned off. Orange squares now set squares back to normal if they've been set to touch their corners.</p><p>Pink squares do not affect pink squares. When more than one pink touches a square, they flip its effect back and forth.</p><p>Pink beats orange, blue, purple, and yellow.</p>"
        },
        default_settings = {
            freqs: {
                0: 4,
                1: 7,
                2: 4,
                3: 4,
                4: 0,
                5: 0,
                6: 0,
                8: 0
            },
            size: 4,
            show_solution_count: 1,
            show_welcome: 1,
            max_sol: 3,
            number_text: 0,
            label_text: 0,
            rules: 1
        };
    var freqs = null == localStorage.getItem("freqs") ? default_settings.freqs : JSON.parse(localStorage.getItem("freqs"));
    window.size = null == localStorage.getItem("size") ? default_settings.size : localStorage.getItem("size");
    var show_solution_count = null == localStorage.getItem("show_solution_count") ? default_settings.show_solution_count : localStorage.getItem("show_solution_count"),
        show_welcome = null == localStorage.getItem("show_welcome") ? default_settings.show_welcome : localStorage.getItem("show_welcome"),
        max_sol = null == localStorage.getItem("max_sol") ? default_settings.max_sol : localStorage.getItem("max_sol"),
        number_text = null == localStorage.getItem("number_text") ? default_settings.number_text : parseInt(localStorage.getItem("number_text")),
        label_text = null == localStorage.getItem("label_text") ? default_settings.label_text : parseInt(localStorage.getItem("label_text")),
        rules = null == localStorage.getItem("rules") ? default_settings.rules : parseInt(localStorage.getItem("rules"));

    function apply_preset(e) {
        for (i = 0; i < e.length; i++) freqs[i] = e[i]
    }

    function new_button() {
        return "<div class='center_button' id='random'>New</div>"
    }

    function next_button() {
        return "<div class='center_button'>" + back_button() + forward_button() + "</div>"
    }

    function forward_button() {
        return "<div id='next'>Next</div>"
    }

    function back_button() {
        return "<div id='prev'>Back</div>"
    }

    function menu_button() {
        return "<div class='side_button' id='menu'>Menu</div>"
    }

    function share_button() {
        return "<div class='side_button' id='share_button'>Share</div>"
    }

    function play_button() {
        return "<div class='center_button' id='play'>Play</div>"
    }

    function blank_button() {
        return "<div class='side_button' id='blank'>Blank</div>"
    }

    function levels_menu() {
        return "<div class='side_button' id='levels_menu'>All boards</div>"
    }

    function free_play() {
        $("#panel_center").html(new_button()), $("#panel_left").html(menu_button()), $("#panel_right").html(share_button())
    }

    function edit_buttons() {
        $("#panel_center").html(play_button()), $("#panel_left").html(menu_button()), $("#panel_right").html(blank_button())
    }

    function level_buttons() {
        $("#panel_center").html(next_button()), $("#panel_left").html(menu_button()), $("#panel_right").html(levels_menu())
    }

    function encode_str(e) {
        const t = (e => {
            const t = e => e.split("").map((e => e.charCodeAt(0))),
                a = e => ("0" + Number(e).toString(16)).substr(-2),
                s = a => t(e).reduce(((e, t) => e ^ t), a);
            return e => e.split("").map(t).map(s).map(a).join("")
        })("squares");
        return t(e)
    }

    function decode_str(e) {
        return (e => {
            const t = t => (e => e.split("").map((e => e.charCodeAt(0))))(e).reduce(((e, t) => e ^ t), t);
            return e => e.match(/.{1,2}/g).map((e => parseInt(e, 16))).map(t).map((e => String.fromCharCode(e))).join("")
        })("squares")(e)
    }

    function export_history() {
        var e = localStorage.getItem("history");
        e ? navigator.share({
            title: "",
            text: encode_str(e)
        }) : ($("#popup_content").html("No history yet. Go play!"), popup_on(), sizing())
    }

    function import_history() {
        $("#popup_content").html("<div id='import_box'><textarea id='import_text'></textarea></div><p>Paste history code above and press \"Import.\"</p><p><span class=\"text_1\"><strong>This will replace your existing history.</strong></span></p><div id='import_button_container'><div id='import_button' class='div_button'>Import</div></div>"), popup_on(), sizing()
    }

    function import_history_go() {
        localStorage.setItem("history", decode_str($("#import_text").val().trim()))
    }

    function main_menu() {
        popup_size = "large";
        var e = "";
        e += "<div action='settings' class='menu_row menu_item text_button'>Settings</div>", e += "<hr>", 1 == levels && (e += "<div action='free_play' class='menu_row menu_item text_button'>Back to free play</div>", e += "<hr>"), e += "<div action='daily' class='menu_row menu_item text_button'>Daily</div>", e += "<hr>", e += "<div action='stats' class='menu_row menu_item text_button'>Stats</div>", e += "<hr>", e += "<div action='history' class='menu_row menu_item text_button'>History</div>", e += "<hr>", e += "<div action='create' class='menu_row menu_item text_button'>Create</div>", e += "<hr>", e += "<div action='explain' class='menu_row menu_item text_button'>Analyze</div>", e += "<hr>", e += "<div action='tutorial' class='menu_row menu_item tutorial_launch text_button'>How to play</div>", e += "<hr>", e += "<div action='about' class='menu_row menu_item text_button'>About</div>", $("#popup_content").html(e), popup_on(), sizing()
    }

    function popup_on() {
        $(".popup").show(), $("#container").css("filter", "blur(6px")
    }

    function popup_off() {
        $(".popup").hide(), $("#container").css("filter", "blur(0px")
    }

    function board_category(e) {
        for (var t in level_packs[1].path) {
            if ("level" == (a = level_packs[1].path[t]).type && a.board == e) return ["tutorial", t]
        }
        for (var t in level_packs[2].path) {
            var a;
            if ("level" == (a = level_packs[2].path[t]).type && a.board == e) return ["daily", t, a.date]
        }
        return ["free"]
    }

    function eval_history(e) {
        var t = 0;
        return e.answers.forEach((function(a) {
            t = e.guesses.includes(a) ? t + 1 : t
        })), t == e.answers.length ? e.guesses.length == e.answers.length ? "perfect" : "complete" : "incomplete"
    }

    function load_daily() {
        var e = JSON.parse(localStorage.getItem("history"));
        e = e || [];
        var t = [];
        for (var a in level_packs[2].path)
            if ("level" == level_packs[2].path[a].type && compare_date(level_packs[2].path[a].date, simple_get_date()) <= 0) {
                var s = {
                    date: level_packs[2].path[a].date,
                    board: level_packs[2].path[a].board,
                    last_played: null
                };
                for (var o in e) e[o].board == s.board && (s.last_played = e[o].last_played, s.status = eval_history(e[o]), s.ontime = ["complete", "perfect"].includes(s.status) && compare_date(s.last_played, s.date) <= 0 ? 1 : 0);
                t.push(s)
            } t.sort((function(e, t) {
            return new Date(e.date) - new Date(t.date)
        }));
        var l = 0,
            r = 0;
        for (var n in t) {
            var i, u;
            0 == n ? (i = 1 == t[n].ontime ? 1 : 0, u = 1 == t[n].ontime && "perfect" == t[n].status ? 1 : 0) : (i = 1 == t[n].ontime ? t[n - 1].streak + 1 : 0, u = 1 == t[n].ontime && "perfect" == t[n].status ? t[n - 1].perfect_streak + 1 : 0), t[n].streak = i, t[n].perfect_streak = u, l = Math.max(i, l), r = Math.max(u, r)
        }
        t.sort((function(e, t) {
            return new Date(t.date) - new Date(e.date)
        }));
        var p = ["complete", "perfect", "incomplete"].includes(t[0].status) ? 0 : 1;
        return {
            daily_pack: t,
            max_streak: l,
            max_perfect_streak: r,
            current_streak: t[p].streak,
            current_perfect_streak: t[p].perfect_streak
        }
    }

    function load_history() {
        var e = JSON.parse(localStorage.getItem("history"));
        e = e || [];
        var t = [],
            a = [];
        for (var s in e) switch (board_category(e[s].board)[0]) {
            case "free":
                t.push(e[s]);
                break;
            case "daily":
                a.push(e[s])
        }
        return {
            free_play: t,
            daily: a
        }
    }

    function stats() {
        var e = load_history(),
            t = e.free_play,
            a = e.daily,
            s = t.length,
            o = 0,
            l = 0;
        for (var r in t) switch (eval_history(t[r])) {
            case "incomplete":
                break;
            case "complete":
                o++;
                break;
            case "perfect":
                o++, l++
        }
        free_complete_rate = s > 0 ? Math.floor(o / s * 1e3) / 10 + "%" : "", free_perfect_rate = s > 0 ? Math.floor(l / s * 1e3) / 10 + "%" : "";
        a = load_daily();
        popup_size = "large", str = "", str += "<span class='heading'>Daily</span>", str += "<hr>", str += "<div class='menu_row'>Current streak<div class='stat'>" + a.current_streak + "</div></div>", str += "<div class='menu_row'>Longest streak<div class='stat'>" + a.max_streak + "</div></div>", str += "<div class='menu_row'>Current perfect streak<div class='stat'>" + a.current_perfect_streak + "</div></div>", str += "<div class='menu_row'>Longest perfect streak<div class='stat'>" + a.max_perfect_streak + "</div></div>", str += "<div class='menu_row'></div>", str += "<span class='heading'>Free play</span>", str += "<hr>", str += "<div class='menu_row'>Played<div class='stat'>" + s + "</div></div>", str += "<div class='menu_row'>Completed<div id='free_completed' class='stat'>" + free_complete_rate + "</div></div>", str += "<div class='menu_row'>Perfect<div id='free_perfect' class='stat'>" + free_perfect_rate + "</div></div>", $("#popup_content").html(str), popup_on(), sizing(), o / s == 1 && sparkle_text_element("free_completed"), l / s == 1 && sparkle_text_element("free_perfect")
    }

    function explain_on() {
        explain = 1, $(".number_text").show(), explain_square(squares, 0), $(".box").css("opacity", .3), $("#square_0").css("opacity", 1), $("#logo, #explain_panel").slideToggle(), $("#controls").hide()
    }

    function explain_off() {
        explain = 0, $("#controls").show(), $("#logo, #explain_panel").slideToggle(), 0 == number_text && $(".number_text").hide(), $(".box").css("opacity", 1)
    }

    function settings() {
        popup_size = "large";
        var e = "";
        e += difficulty_buttons(), e += "<hr>", e += "<div action='toggle_solution_count' target='#show_solution_checkbox' class='menu_row'>Show solution count <div id='show_solution_checkbox' class='checkbox " + (1 == show_solution_count ? "checked" : "") + "'></div></div>", e += "<hr>", e += "<div action='toggle_welcome' target='#show_welcome_checkbox' class='menu_row'>Show welcome<div id='show_welcome_checkbox' class='checkbox " + (1 == show_welcome ? "checked" : "") + "'></div></div>", e += "<hr>", e += "<div action='show_rules' target='#show_rules' class='menu_row'>Show rules guide<div id='show_rules' class='checkbox " + (1 == rules ? "checked" : "") + "'></div></div>", e += "<hr>", e += "<div action='show_numbers' target='#show_numbers_checkbox' class='menu_row'>Show square numbers<div id='show_numbers_checkbox' class='checkbox " + (1 == number_text ? "checked" : "") + "'></div></div>", e += "<hr>", e += "<div action='show_labels' target='#show_labels_checkbox' class='menu_row'>Show square color labels<div id='show_labels_checkbox' class='checkbox " + (1 == label_text ? "checked" : "") + "'></div></div>", e += "<hr>", e += "<div class='menu_row'>Board size <select class='select' id='board_size'>";
        for (var t = 3; t < 13; t++) e += "<option " + (size == t ? "selected" : "") + " value=" + t + ">" + t + "</option>";
        e += "</select></div>", e += "<hr>", e += "<div class='menu_row' id='max_sol_row'>", e += max_solutions_select(), e += "</div><hr>", e += "<p>Color frequency</p>", e += "<div class='table'>";
        var a = [0, 1, 2, 3, 4, 5, 8, 6],
            s = ["White", "Red", "Green", "Yellow", "Purple", "Blue", "Orange", "Pink"];
        for (t = 0; t < a.length; t++) e += "<div class='row'><div class='cell'><span class='text_" + a[t] + "'><strong>" + s[t] + ":</strong></span></div><div class='cell'><input type='range' class='freq_slider' number='" + a[t] + "' value='" + freqs[a[t]] + "' id='slider_" + a[t] + "' name='slider_" + a[t] + "' min='0' max='10' step='1'></div></div>";
        e += "<br/><strong>Presets:</strong> <br/>", e += "<span class='text_button text_0 preset' preset=1>Reds and greens</span><br/>", e += "<span class='text_button text_0 preset' preset=2>Reds, greens, yellows</span><br/>", e += "<span class='text_button text_0 preset' preset=3>Reds and purples</span><br/>", e += "<span class='text_button text_0 preset' preset=4>White through blue</span><br/>", e += "<span class='text_button text_0 preset' preset=5>All colors</span><br/>", e += "<span class='text_button text_0 preset' preset=6>Madness</span><br/>", e += "</div>", e += "<br/><hr>", e += "<p>Settings and game history will be saved on this device.</p>", e += "<hr>", e += "<div action='export_history' class='menu_row'>Export history</div>", e += "<hr>", e += "<div action='import_history' class='menu_row'>Import history</div>", e += "<hr>", e += "<div action='clear_history' class='menu_row'><span id='clear_history_message' class='text_1'>Clear all history</span></div>", $("#popup_content").html(e), popup_on(), sizing()
    }

    function max_solutions_select() {
        for (var e = "Max solutions (size 3-6) <select " + (size > 6 ? "disabled" : "") + " class='select' id='max_sol'>", t = 1; t < size ** 2 + 1; t++) {
            e += "<option " + (max_sol == t ? "selected" : "") + " value=" + t + ">" + t + "</option>"
        }
        return e += "</select>"
    }

    function edit_toggle(e = -1) {
        0 == edit || 1 == e ? (edit = 1, levels = 0, edit_buttons()) : 1 != edit && 0 != e || (edit = 0, free_play())
    }

    function apply_difficulty(e) {
        switch (e) {
            case "beginner":
                apply_preset(preset_lib[1]), size = 3, max_sol = 3, show_solution_count = 1;
                break;
            case "easy":
                apply_preset(preset_lib[2]), size = 4, max_sol = 3, show_solution_count = 1;
                break;
            case "medium":
                apply_preset(preset_lib[4]), size = 4, max_sol = 3, show_solution_count = 1;
                break;
            case "hard":
                apply_preset(preset_lib[5]), size = 4, max_sol = 3, show_solution_count = 0;
                break;
            case "painful":
                apply_preset(preset_lib[7]), size = 5, max_sol = 3, show_solution_count = 0
        }
        localStorage.setItem("size", parseInt(size)), localStorage.setItem("freqs", JSON.stringify(freqs)), localStorage.setItem("max_sol", max_sol), localStorage.setItem("show_solution_count", show_solution_count)
    }

    function difficulty_buttons() {
        var e = "";
        e += "<div class='difficulty_button daily'>today's daily board</div>";
        var t = {
            0: {
                label: "beginner",
                class: "beginner"
            },
            1: {
                label: "easy",
                class: "easy"
            },
            2: {
                label: "medium",
                class: "medium"
            },
            3: {
                label: "hard",
                class: "hard"
            },
            4: {
                label: "too hard",
                class: "painful"
            }
        };
        for (i = 0; i < Object.keys(t).length; i++) e += "<div difficulty='" + t[i].class + "' class='difficulty_button " + t[i].class + "'>" + t[i].label + "</div>";
        return e
    }

    function build_history() {
        var e = JSON.parse(localStorage.getItem("history")),
            t = {
                incomplete: "<span class='text_1'>Incomplete </span> ",
                complete: "Complete",
                perfect: "<span class='text_2'>Perfect! </span>"
            },
            a = [];
        return e ? (e.forEach((function(e) {
            a.push({
                name: t[eval_history(e)],
                board: e.board,
                type: "level"
            })
        })), a.reverse()) : 0
    }

    function store_level() {
        var e = [];
        if (localStorage.getItem("history")) {
            e = JSON.parse(localStorage.getItem("history"));
            var t = find_level(board);
            t > -1 ? (e[t].guesses = guesses, e[t].last_played = simple_get_date()) : e.push({
                board: board,
                guesses: guesses,
                answers: final,
                last_played: simple_get_date()
            })
        } else e.push({
            board: board,
            guesses: guesses,
            answers: final,
            last_played: simple_get_date()
        });
        localStorage.setItem("history", JSON.stringify(e))
    }

    function find_level(e) {
        if (localStorage.getItem("history"))
            for (game_history = JSON.parse(localStorage.getItem("history")), i = 0; i < game_history.length; i++)
                if (game_history[i].board == e) return i;
        return -1
    }

    function load_guesses(e) {
        return game_history = JSON.parse(localStorage.getItem("history")), game_history[e].guesses
    }

    function clear_history() {
        localStorage.removeItem("history"), $("#clear_history_message").html("History cleared")
    }

    function history_menu() {
        popup_size = "large";
        var e, t = build_history(),
            a = "",
            s = "";
        t ? t.forEach(((o, l) => {
            switch ((e = board_category(o.board))[0]) {
                case "free":
                    s = "";
                    break;
                case "tutorial":
                    s = "Tutorial";
                    break;
                case "daily":
                    s = "Daily (" + day_str(e[2], "simple") + ")"
            }
            a += "<div board='" + o.board + "' class='text_button history_menu_item'><span class='history_status'>" + o.name + "</span>" + s + tiny_board(o.board) + "</div>" + (l < t.length - 1 ? "<hr>" : "")
        })) : a = "No history. Play a board!", $("#popup_content").html(a), popup_on(), sizing()
    }

    function day_str(e, t = "full") {
        var a = simple_parse_date(e),
            s = new Date(Date.UTC(1 * a.year, 1 * a.month - 1, 1 * a.day));
        switch (t) {
            case "full":
                return ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][s.getUTCDay()] + ", " + a.month + "/" + a.day + "/" + a.year;
            case "simple":
                return a.month + "/" + a.day + "/" + a.year
        }
    }

    function daily_menu() {
        popup_size = "large";
        const e = load_daily().daily_pack;
        status_message = {
            complete: "Complete",
            incomplete: "<span class='text_1'>Incomplete</span>",
            perfect: "<span class='text_2'>Perfect!</span>"
        };
        var t = "";
        for (var a in e) {
            var s = e[a].streak > 0 ? "<div class='tiny_overlay'>" + e[a].streak + "</div>" : "";
            t += "<div board='" + e[a].board + "' class='daily_menu_item'><div class='date'>" + day_str(e[a].date) + "</div>" + (e[a].status ? status_message[e[a].status] : "") + tiny_board(e[a].board) + s + "</div><hr>"
        }
        t = t.slice(0, -1 * "<hr>".length), $("#popup_content").html(t), popup_on(), sizing()
    }

    function sizing() {
        var e = window.innerWidth,
            t = window.innerHeight;
        e > 1200 ? (container_width = 540, container_offset = (e - 540) / 2) : e <= 1200 && (container_width = .6 * t >= .9 * e ? .9 * e : .6 * t, container_offset = (e - container_width) / 2), $("#container").css({
            left: container_offset,
            width: container_width
        }), $("#gameboard").each((function() {
            $(this).attr("width", $("#container").width()), $(this).attr("height", $(this).attr("width"))
        })), button_height = .07 * container_width, button_width = .15 * container_width, $(".div_button").css({
            width: button_width,
            height: button_height
        }), $(".difficulty_button").css({
            height: .06 * t
        });
        var a = container_width / 30,
            s = 1.5 * a;
        a < 13 && (a = 15), $("body, input, select").css("font-size", a + "px"), $(".popup_heading").css("font-size", s + "px");
        $("#info_bar").css("left", .01 * container_width);
        $("#overlay").height($(document).height());
        var o = .95 * container_width - 20,
            l = .1 * o,
            r = container_offset + (container_width - o) / 2;
        switch (popup_size) {
            case "large":
                var n = .8 * t,
                    i = 1.3;
                break;
            case "small":
                n = .3 * t, i = .7
        }
        $(".popup_next").css({
            left: o - button_width,
            top: n - 2 * button_height
        }), border_radius = e > 900 ? e / 180 : 5;
        var u = document.getElementById("gameboard").getBoundingClientRect();
        $("#popup").css({
            width: o,
            "max-height": u.height * i,
            left: r,
            "border-radius": border_radius
        }), $("#popup_content").css({
            padding: l
        });
        var p = u.top + u.height / 2 - parseFloat($("#popup").css("height")) / 2;
        $("#popup").css({
            top: p
        }), $(".level_menu_item, .history_menu_item, .daily_menu_item").css({
            height: .2 * u.height
        }), $("#explain_panel").css({
            width: container_width - 20
        }), $("#controls").css({
            height: .1 * container_width
        }), $("#panel_left").css({
            left: 0 * $("#controls").width(),
            width: "30%"
        }), $("#panel_center").css({
            left: .3 * $("#controls").width(),
            width: "40%"
        }), $("#panel_right").css({
            left: .7 * $("#controls").width(),
            width: "30%"
        });
        var d = document.getElementById("non-board").getBoundingClientRect(),
            c = document.getElementById("controls").getBoundingClientRect(),
            h = document.getElementById("explain_panel").getBoundingClientRect();
        $("#level_text").css({
            top: c.bottom - d.top + 30,
            width: container_width
        });
        var _ = document.getElementById("level_text").getBoundingClientRect(),
            b = .8 * parseInt($(".level_menu_item, .history_menu_item, .daily_menu_item").css("height"), 10);
        $(".tiny_board, .tiny_overlay").css({
            width: b + "px",
            right: 0,
            height: b + "px"
        });
        var f = .2 * parseInt($("#gameboard").css("height"), 10);
        $("#logo_svg").attr("height", f), $("#logo").css({
            left: .98 * container_width / 2 - document.getElementById("logo_white").getBoundingClientRect().width / 2,
            width: container_width / 2
        }), $("#rules").css({
            top: ("none" != $("#level_text").css("display") ? _.bottom : 1 == explain ? h.bottom : c.bottom) - d.top + 30,
            width: "100%"
        })
    }

    function tiny_board(e, t = null) {
        for (var a = .11 * parseInt($("#container").css("width"), 10), s = "<svg opacity='" + t + "' class='tiny_board' width='" + a + "' height='" + a + "' stroke='#3B393A' stroke-width='1px'>", o = e.split(""), l = Math.sqrt(o.length), r = 100 / l, n = 0; n < o.length; n++) {
            var i = n % l * r,
                u = Math.floor(n / l) * r;
            s += "<rect class='type_" + o[n] + "' width='" + r + "%' height='" + r + "%' x='" + i + "%' y='" + u + "%' ></rect>"
        }
        return s += "<rect width='100%' height='100%' fill='none' stroke='#3B393A' stroke-width='1px'></rect></svg>"
    }

    function sparkle(e = ".logo_letter", t = "fill") {
        window.board;
        var a = {
            1: "#FE4B72",
            2: "#2ECCB2",
            3: "#FDDE4E",
            4: "#7F63AC",
            5: "#52A9D4",
            6: "#FF8EAC",
            7: "#FF9966"
        };
        $(e).each((function() {
            $(this).fadeOut(400 * Math.random()).css(t, a[Math.floor(7 * Math.random() + 1)]).delay(100 * Math.random()).fadeIn(400 * Math.random()).fadeOut(400 * Math.random()).css(t, a[Math.floor(7 * Math.random() + 1)]).delay(100 * Math.random()).fadeIn(400 * Math.random())
        }))
    }

    function sparkle_text(e) {
        var t = [1, 2, 3, 4, 5, 6, 8],
            a = e.split(""),
            s = [];
        return a.forEach((function(e) {
            var a = "text_" + t[Math.floor(7 * Math.random() + 1)];
            s.push("<span class='" + a + "'>" + e + "</span>")
        })), s.join("")
    }

    function sparkle_text_element(e) {
        for (var t in text = $("#" + e).html(), text_arr = text.split(""), new_str = "", text_arr) new_str += "<span style='font-weight:bold' class='" + e + "_sparkle'>" + text_arr[t] + "</span>";
        $("#" + e).html(new_str);
        $("." + e + "_sparkle").each((function() {
            var e = 400 * Math.random(),
                t = 100 * Math.random(),
                a = 400 * Math.random();
            $(this).fadeOut(e).addClass("text_" + Math.floor(7 * Math.random() + 1)).delay(t).fadeIn(a).fadeOut(e).addClass("text_" + Math.floor(7 * Math.random() + 1)).delay(t).fadeIn(a)
        }))
    }

    function cycle_square(e) {
        var t = window.board;
        let a = t.split("");
        a[e] < 5 ? a[e]++ : 5 == a[e] ? a[e] = 8 : 8 == a[e] ? a[e] = 6 : a[e] = 0, setup(t = a.join(""))
    }

    function welcome() {
        title = sparkle_text("squares");
        var e = "<p><span class='title'>Welcome to </span><span class='logo'>" + title + "</span>.</p>";
        e += "<p>First time? Try the <span class='text_2 text_button tutorial_launch'>tutorial</span>. Or, try today's daily board or a random board at any difficulty level.</p> <p>You can always customize the game in the <span class='text_2 text_button settings_launch'>settings menu.</span></p>", e += difficulty_buttons(), $("#popup_content").html(e), popup_on()
    }
    $(window).resize((function() {
        sizing()
    }));
    var m1 = function() {
            popup_size = "large";
            var e = "<div class='popup_heading'>Levels</div><hr/>";
            let t = Object.keys(level_packs),
                a = ["Menu"];
            t.forEach((function(t, s) {
                var o = level_packs[t].name,
                    l = level_packs[t].desc;
                a.includes(o) || (e += "<p pack_number='" + t + "' class='pack_menu_item text_button'><span class='text_5'>" + o + "</span><br/>" + l + "</p>")
            })), $("#popup_content").html(e), popup_on()
        },
        p1 = function() {
            popup_size = "large";
            var e = level_packs[level_pos.pack],
                t = "";
            let a = Object.keys(e.path);
            a.forEach((function(a, s) {
                "action" != e.path[a].type && (t += "<div step_number='" + a + "' class='text_button level_menu_item'>" + e.path[a].name + tiny_board(e.path[a].board) + "</div><hr>")
            })), t = t.slice(0, -1 * "<hr>".length), $("#popup_content").html(t), popup_on(), sizing()
        },
        r1 = function() {
            level_pos.step = 0, setup()
        },
        g1 = function() {
            levels = 0, settings()
        };
    const level_packs = {
        0: {
            name: "Menu",
            path: {
                0: {
                    type: "action",
                    func: m1
                }
            }
        },
        1: {
            name: "Tutorial",
            desc: "A walkthrough of game basics.",
            path: {
                0: {
                    type: "action",
                    func: p1
                },
                1: {
                    name: "Introduction",
                    type: "level",
                    text: "Win the board by choosing every square that is a solution. In this board, all the squares are solutions.",
                    board: "0000"
                },
                2: {
                    name: "<span style='white-space:pre' class='text_2'><strong>Green </strong></span> and <span style='white-space:pre' class='text_1'><strong> Red </strong></span> squares",
                    type: "level",
                    text: "Squares that touch (share a side with) more green squares than red squares are solutions. Squares don't touch themselves.",
                    board: "000201000"
                },
                3: {
                    name: "Red and Green Practice 1",
                    type: "level",
                    text: "Let's try a few.",
                    board: "000201200"
                },
                4: {
                    name: "Red and Green Practice 2",
                    type: "level",
                    text: "Here's another. ",
                    board: "022100001"
                },
                5: {
                    name: "Another way to solve",
                    type: "level",
                    text: "<strong>If</strong> there are no squares that touch more green than red, then any square that touches an <i>equal</i> number of green and red squares is a solution.",
                    board: "2011"
                },
                6: {
                    name: "Red and Green Practice 3",
                    type: "level",
                    text: "Touching an equal number of greens and reds includes touching <i>zero</i> of each.",
                    board: "210110000"
                },
                7: {
                    name: "Red and Green Practice 4",
                    type: "level",
                    text: "Some more practice. It will get harder.",
                    board: "0100102000010020"
                },
                8: {
                    name: "Red and Green Practice 5",
                    type: "level",
                    text: "One more.",
                    board: "2010010120200201"
                },
                9: {
                    name: "Red and Green Practice 6",
                    type: "level",
                    text: "Try the Reds and Greens preset in the Settings menu to play boards with only Red and Green squares.",
                    board: "100112010"
                },
                10: {
                    name: "<span class='text_3'><strong>Yellow squares</strong></span>",
                    type: "level",
                    text: "<span class='text_3'>Yellow squares.</span> Any square that touches a yellow square has its effect turned off. This red touches a yellow, so it is like a white square: it has no effect.",
                    board: "102300000"
                },
                11: {
                    name: "Yellow on Yellow",
                    type: "level",
                    text: "If yellows touch one another, they turn one another off. Since these yellows are off, they don't turn off any other squares.",
                    board: "201330000"
                },
                12: {
                    name: "Yellow groups",
                    type: "level",
                    text: "All the yellows in a group turn one another off.",
                    board: "201333320"
                },
                13: {
                    name: "Yellow practice 1",
                    type: "level",
                    text: "Let's try a few.",
                    board: "330002311"
                },
                14: {
                    name: "Yellow practice 2",
                    type: "level",
                    text: "",
                    board: "230301020"
                },
                15: {
                    name: "Yellow practice 3",
                    type: "level",
                    text: "",
                    board: "323022321"
                },
                16: {
                    name: "<span class='text_4'><strong>Purple squares</strong></span>",
                    type: "level",
                    text: "<span class='text_4'>Purple squares.</span> Purple squares <i>extend</i> the effect of the squares they touch across the entire column and row. Because it touches a purple, the green in the lower corner acts like it touches every square in the left column and the bottom row (but still not itself).",
                    board: "000000240"
                },
                17: {
                    name: "Order of Operations",
                    type: "level",
                    text: "When two squares would change one another's behavior, one needs to take precedence. Purple beats yellow: the purple extends the yellow, but the yellow does <i>not</i> turn off the purple.",
                    board: "1000200002003400"
                },
                18: {
                    name: "Purple on purple",
                    type: "level",
                    text: "Purples can extend other purples. The extended purple touches the green.",
                    board: "2000000000004400"
                },
                19: {
                    name: "Extension and precedence",
                    type: "level",
                    text: "Starting to get harder.<br/><br/>Although purple beats yellow when they touch, this yellow touches a purple but the purple can't reach the yellow, so yellow wins.",
                    board: "3004000200004400"
                },
                20: {
                    name: "<span class='text_5'><strong>Blue squares</strong></span>",
                    type: "level",
                    text: "<span class='text_5'>Blue squares</span><br/>A square that touches a blue square acts like it touches itself.<br/><br/>The green square now touches itself, so it's a solution.",
                    board: "000025000"
                },
                21: {
                    name: "Blue on yellow",
                    type: "level",
                    text: "This yellow square touches itself, so it turns itself off.<br/><br/>Blue beats purple and yellow.",
                    board: "005023000"
                },
                22: {
                    name: "Blue on purple",
                    type: "level",
                    text: "A purple square touching a blue square extends itself. Since blue beats purple, the blue is <i>not</i> extended.",
                    board: "2000000000004500"
                },
                23: {
                    name: "Blue/Purple/Yellow practice",
                    type: "level",
                    text: 'Follow it around...<br/><br/>The next two colors are the hardest. For now, you can try the "White through blue" preset in settings.',
                    board: "3005020400004500"
                },
                24: {
                    name: "<span class='text_8'><strong>Orange squares</strong></span>",
                    type: "level",
                    text: "<span class='text_8'>Orange squares. </span>A square touching an orange square now affects the squares at its corners, not the ones it shares a side with.<br/><br/>Orange beats blue, purple, and yellow.",
                    board: "000028000"
                },
                25: {
                    name: "Diagonals",
                    type: "level",
                    text: "If a square touching an orange is extended by a purple, it touches everything on its diagonals rather than its row and column.<br/><br/>Don't forget the blue!",
                    board: "0401820005000000"
                },
                26: {
                    name: "Orange on Orange",
                    type: "level",
                    text: "Oranges touching each other make each other touch things at their corners.",
                    board: "0000000008822000"
                },
                27: {
                    name: "<span class='text_6'><strong>Pink squares</strong></span>",
                    type: "level",
                    text: "<span class='text_6'>Pink squares. </span>Pink squares reverse the effect of the squares they touch. Here, the red acts like a green and the green like a red.<br/><br/>Pink beats orange, blue, purple, and yellow.",
                    board: "000162000"
                },
                28: {
                    name: "Pinks, Blues, and Purples",
                    type: "level",
                    text: "Pinks make blues act like purples and purples act like blues.",
                    board: "2001465000200000"
                },
                29: {
                    name: "Pinks on yellows",
                    type: "level",
                    text: "Pinks make yellows go from turning other squares <i>off</i> to turning them back <i>on</i>.",
                    board: "4032400300060000"
                },
                30: {
                    name: "Pinks on oranges",
                    type: "level",
                    text: "Similiarly, pinks reverse oranges so that they set other squares back to touching the ones at their sides instead of the ones at their corners.",
                    board: "4082400800060000"
                },
                31: {
                    name: "Multiple pinks",
                    type: "level",
                    text: "If more than one pink acts on a square, they flip it back and forth.<br/><br/>This green is flipped to a red and back to green by touching two pinks.",
                    board: "0000626000000000"
                },
                32: {
                    name: "Pink on pink",
                    type: "level",
                    text: "Thankfully, pinks have no effect on pinks.",
                    board: "000026006"
                },
                33: {
                    name: "<strong>Advanced</strong>",
                    type: "level",
                    text: "There are a few advanced situations that pop up. Here the pink is extended by a purple - so shouldn't it come back and flip that same purple to blue? No: an extended purple is protected from the squares it extends. No backsies.",
                    board: "0000600400041000"
                },
                34: {
                    name: "Advanced 2",
                    type: "level",
                    text: "Here, the blue makes the purple extend itself, so the purple is extended and touches the pink. The pink is extended and touches the blue, switching it to purple. This is allowed, since when the blue switches to purple, it still extends the original purple.",
                    board: "0201000060540000"
                },
                35: {
                    name: "The End",
                    type: "level",
                    text: "<p>That's it! Start easy, with just the first few colors, and then move on to more colors and bigger boards as you get comfortable. You can customize the puzzle from the Settings menu and keep the rules guide to help as you play.</p><p>Good luck!</p>",
                    board: "2"
                },
                36: {
                    type: "action",
                    func: g1
                }
            }
        },
        2: {
            name: "Daily levels",
            desc: "Daily levels",
            path: {
                0: {
                    type: "action",
                    func: daily_menu
                },
                1: {
                    type: "level",
                    date: "2022-08-31",
                    board: "1125245010500014",
                    text: ""
                },
                2: {
                    type: "level",
                    date: "2022-08-30",
                    board: "0050103010240055",
                    text: ""
                },
                3: {
                    type: "level",
                    date: "2022-08-29",
                    board: "2111131231321131",
                    text: ""
                },
                4: {
                    type: "level",
                    date: "2022-08-28",
                    board: "0206603322605010045054826",
                    text: ""
                },
                5: {
                    type: "level",
                    date: "2022-08-27",
                    board: "5534163561011051",
                    text: ""
                },
                6: {
                    type: "level",
                    date: "2022-08-26",
                    board: "1142510055405308",
                    text: ""
                },
                7: {
                    type: "level",
                    date: "2022-08-25",
                    board: "2002025046400500",
                    text: ""
                },
                8: {
                    type: "level",
                    date: "2022-08-24",
                    board: "4154200041010003",
                    text: ""
                },
                9: {
                    type: "level",
                    date: "2022-08-23",
                    board: "2021411310104440",
                    text: ""
                },
                10: {
                    type: "level",
                    date: "2022-08-22",
                    board: "2331011310210102",
                    text: ""
                },
                11: {
                    type: "level",
                    date: "2022-08-21",
                    board: "0651000154351164004113650",
                    text: ""
                },
                12: {
                    type: "level",
                    date: "2022-08-20",
                    board: "8054211536535854",
                    text: ""
                },
                13: {
                    type: "level",
                    date: "2022-08-19",
                    board: "5056361155605306",
                    text: ""
                },
                14: {
                    type: "level",
                    date: "2022-08-18",
                    board: "2004015130022034",
                    text: ""
                },
                15: {
                    type: "level",
                    date: "2022-08-17",
                    board: "1554023325503250",
                    text: ""
                },
                16: {
                    type: "level",
                    date: "2022-08-16",
                    board: "4113005102140130",
                    text: ""
                },
                17: {
                    type: "level",
                    date: "2022-08-15",
                    board: "3020200113301010",
                    text: ""
                },
                18: {
                    type: "level",
                    date: "2022-08-14",
                    board: "0053402211086681652438401",
                    text: ""
                },
                19: {
                    type: "level",
                    date: "2022-08-13",
                    board: "3048685534215605",
                    text: ""
                },
                20: {
                    type: "level",
                    date: "2022-08-12",
                    board: "0820054204403406",
                    text: ""
                },
                21: {
                    type: "level",
                    date: "2022-08-11",
                    board: "2055505004401118",
                    text: ""
                },
                22: {
                    type: "level",
                    date: "2022-08-10",
                    board: "4055411015510103",
                    text: ""
                },
                23: {
                    type: "level",
                    date: "2022-08-09",
                    board: "4120335104002310",
                    text: ""
                },
                24: {
                    type: "level",
                    date: "2022-08-08",
                    board: "2331113111220001",
                    text: ""
                },
                25: {
                    type: "level",
                    date: "2022-08-07",
                    board: "5532550215015100562004345",
                    text: ""
                },
                26: {
                    type: "level",
                    date: "2022-08-06",
                    board: "6622434058050015",
                    text: ""
                },
                27: {
                    type: "level",
                    date: "2022-08-05",
                    board: "8553121452151231",
                    text: ""
                },
                28: {
                    type: "level",
                    date: "2022-08-04",
                    board: "2532420641253255",
                    text: ""
                },
                29: {
                    type: "level",
                    date: "2022-08-03",
                    board: "3010150340313512",
                    text: ""
                },
                30: {
                    type: "level",
                    date: "2022-08-02",
                    board: "1501111200305000",
                    text: ""
                },
                31: {
                    type: "level",
                    date: "2022-08-01",
                    board: "1131113110310213",
                    text: ""
                },
                32: {
                    type: "level",
                    date: "2022-07-31",
                    board: "5451215314145000286006608",
                    text: ""
                },
                33: {
                    type: "level",
                    date: "2022-07-30",
                    board: "1155455280861110",
                    text: ""
                },
                34: {
                    type: "level",
                    date: "2022-07-29",
                    board: "1311405814541205",
                    text: ""
                },
                35: {
                    type: "level",
                    date: "2022-07-28",
                    board: "1032550541310028",
                    text: ""
                },
                36: {
                    type: "level",
                    date: "2022-07-27",
                    board: "4000041335502300",
                    text: ""
                },
                37: {
                    type: "level",
                    date: "2022-07-26",
                    board: "1502553030152410",
                    text: ""
                },
                38: {
                    type: "level",
                    date: "2022-07-25",
                    board: "0212110020110231",
                    text: ""
                },
                39: {
                    type: "level",
                    date: "2022-07-24",
                    board: "0015043868456434461201021",
                    text: ""
                },
                40: {
                    type: "level",
                    date: "2022-07-23",
                    board: "1555413321008444",
                    text: ""
                },
                41: {
                    type: "level",
                    date: "2022-07-22",
                    board: "5512363352030450",
                    text: ""
                },
                42: {
                    type: "level",
                    date: "2022-07-21",
                    board: "3560450054068341",
                    text: ""
                },
                43: {
                    type: "level",
                    date: "2022-07-20",
                    board: "0442425101115345",
                    text: ""
                },
                44: {
                    type: "level",
                    date: "2022-07-19",
                    board: "1002421002041201",
                    text: ""
                },
                45: {
                    type: "level",
                    date: "2022-07-18",
                    board: "1021111111000100",
                    text: ""
                },
                46: {
                    type: "level",
                    date: "2022-07-17",
                    board: "0282126444800312014144440",
                    text: ""
                },
                47: {
                    type: "level",
                    date: "2022-07-16",
                    board: "5621141445401180",
                    text: ""
                },
                48: {
                    type: "level",
                    date: "2022-07-15",
                    board: "3206013410106111",
                    text: ""
                },
                49: {
                    type: "level",
                    date: "2022-07-14",
                    board: "0006004350802120",
                    text: ""
                },
                50: {
                    type: "level",
                    date: "2022-07-13",
                    board: "2315115150310145",
                    text: ""
                },
                51: {
                    type: "level",
                    date: "2022-07-12",
                    board: "5041330315200100",
                    text: ""
                },
                52: {
                    type: "level",
                    date: "2022-07-11",
                    board: "2100201112110232",
                    text: ""
                },
                53: {
                    type: "level",
                    date: "2022-07-10",
                    board: "5545218086350181644343115",
                    text: ""
                },
                54: {
                    type: "level",
                    date: "2022-07-09",
                    board: "3131413811148463",
                    text: ""
                },
                55: {
                    type: "level",
                    date: "2022-07-08",
                    board: "3113306584014651",
                    text: ""
                },
                56: {
                    type: "level",
                    date: "2022-07-07",
                    board: "4003302040150884",
                    text: ""
                },
                57: {
                    type: "level",
                    date: "2022-07-06",
                    board: "1854603535006511",
                    text: ""
                },
                58: {
                    type: "level",
                    date: "2022-07-05",
                    board: "2550553051010404",
                    text: ""
                },
                59: {
                    type: "level",
                    date: "2022-07-04",
                    board: "0022012130111101",
                    text: ""
                },
                60: {
                    type: "level",
                    date: "2022-07-03",
                    board: "5516001824202516850244102",
                    text: ""
                },
                61: {
                    type: "level",
                    date: "2022-07-02",
                    board: "1505050624562335",
                    text: ""
                },
                62: {
                    type: "level",
                    date: "2022-07-01",
                    board: "1504141114155586",
                    text: ""
                },
                63: {
                    type: "level",
                    date: "2022-06-30",
                    board: "5440455285011140",
                    text: ""
                },
                64: {
                    type: "level",
                    date: "2022-06-29",
                    board: "4330110405550121",
                    text: ""
                },
                65: {
                    type: "level",
                    date: "2022-06-28",
                    board: "0550151143131055",
                    text: ""
                },
                66: {
                    type: "level",
                    date: "2022-06-27",
                    board: "2101321221123202",
                    text: ""
                },
                67: {
                    type: "level",
                    date: "2022-06-26",
                    board: "1140581202024060444012102",
                    text: ""
                },
                68: {
                    type: "level",
                    date: "2022-06-25",
                    board: "3430681233514028101540238",
                    text: ""
                },
                69: {
                    type: "level",
                    date: "2022-06-24",
                    board: "2654131551133443",
                    text: ""
                },
                70: {
                    type: "level",
                    date: "2022-06-23",
                    board: "1841154156441114",
                    text: ""
                },
                71: {
                    type: "level",
                    date: "2022-06-22",
                    board: "1401238411401016",
                    text: ""
                },
                72: {
                    type: "level",
                    date: "2022-06-21",
                    board: "3230200000450043",
                    text: ""
                },
                73: {
                    type: "level",
                    date: "2022-06-20",
                    board: "2001111321301112",
                    text: ""
                },
                74: {
                    type: "level",
                    date: "2022-06-19",
                    board: "0041465803064214163124310",
                    text: ""
                },
                75: {
                    type: "level",
                    date: "2022-06-18",
                    board: "8143503516431856",
                    text: ""
                },
                76: {
                    type: "level",
                    date: "2022-06-17",
                    board: "6314218033343040",
                    text: ""
                },
                77: {
                    type: "level",
                    date: "2022-06-16",
                    board: "4452111111136432",
                    text: ""
                },
                78: {
                    type: "level",
                    date: "2022-06-15",
                    board: "5500560505112353",
                    text: ""
                },
                79: {
                    type: "level",
                    date: "2022-06-14",
                    board: "3333151001011001",
                    text: ""
                },
                80: {
                    type: "level",
                    date: "2022-06-13",
                    board: "1211110123321023",
                    text: ""
                },
                81: {
                    type: "level",
                    date: "2022-06-12",
                    board: "0141052254205126004653622",
                    text: ""
                },
                82: {
                    type: "level",
                    date: "2022-06-11",
                    board: "3636453242452434",
                    text: ""
                },
                83: {
                    type: "level",
                    date: "2022-06-10",
                    board: "0451142143641842",
                    text: ""
                },
                84: {
                    type: "level",
                    date: "2022-06-09",
                    board: "8605055601106141",
                    text: ""
                },
                85: {
                    type: "level",
                    date: "2022-06-08",
                    board: "4142415450515113",
                    text: ""
                },
                86: {
                    type: "level",
                    date: "2022-06-07",
                    board: "1204151144110513",
                    text: ""
                },
                87: {
                    type: "level",
                    date: "2022-06-06",
                    board: "1013302230111122",
                    text: ""
                },
                88: {
                    type: "level",
                    date: "2022-06-05",
                    board: "1112048331146302201482621",
                    text: ""
                },
                89: {
                    type: "level",
                    date: "2022-06-04",
                    board: "3416188156431135",
                    text: ""
                },
                90: {
                    type: "level",
                    date: "2022-06-03",
                    board: "0410640155214355",
                    text: ""
                },
                91: {
                    type: "level",
                    date: "2022-06-02",
                    board: "4011168400580115",
                    text: ""
                },
                92: {
                    type: "level",
                    date: "2022-06-01",
                    board: "6214111200180101",
                    text: ""
                },
                93: {
                    type: "level",
                    date: "2022-05-31",
                    board: "0043240140111000",
                    text: ""
                },
                94: {
                    type: "level",
                    date: "2022-05-30",
                    board: "1011101022321013",
                    text: ""
                },
                95: {
                    type: "level",
                    date: "2022-05-29",
                    board: "1440046500053405236480525",
                    text: ""
                },
                96: {
                    type: "level",
                    date: "2022-05-28",
                    board: "4136864155816531",
                    text: ""
                },
                97: {
                    type: "level",
                    date: "2022-05-27",
                    board: "8415041145468004",
                    text: ""
                },
                98: {
                    type: "level",
                    date: "2022-05-26",
                    board: "0451826210125144",
                    text: ""
                },
                99: {
                    type: "level",
                    date: "2022-05-25",
                    board: "5441635105025403",
                    text: ""
                },
                100: {
                    type: "level",
                    date: "2022-05-24",
                    board: "3540004413325101",
                    text: ""
                },
                101: {
                    type: "level",
                    date: "2022-05-23",
                    board: "1121132031211121",
                    text: ""
                },
                102: {
                    type: "level",
                    date: "2022-05-22",
                    board: "1440241115024514281116102",
                    text: ""
                },
                103: {
                    type: "level",
                    date: "2022-05-21",
                    board: "1866365661154414",
                    text: ""
                },
                104: {
                    type: "level",
                    date: "2022-05-20",
                    board: "4611081310265534",
                    text: ""
                },
                105: {
                    type: "level",
                    date: "2022-05-19",
                    board: "1512221163251864",
                    text: ""
                },
                106: {
                    type: "level",
                    date: "2022-05-18",
                    board: "3140410434134051",
                    text: ""
                },
                107: {
                    type: "level",
                    date: "2022-05-17",
                    board: "0501411115143101",
                    text: ""
                },
                108: {
                    type: "level",
                    date: "2022-05-16",
                    board: "3211111321322213113221000",
                    text: ""
                },
                109: {
                    type: "level",
                    date: "2022-05-15",
                    board: "1830252601202335551003631",
                    text: ""
                },
                110: {
                    type: "level",
                    date: "2022-05-14",
                    board: "6135520643540438",
                    text: ""
                },
                111: {
                    type: "level",
                    date: "2022-05-13",
                    board: "6450054436212406",
                    text: ""
                },
                112: {
                    type: "level",
                    date: "2022-05-12",
                    board: "4635320021116405",
                    text: ""
                },
                113: {
                    type: "level",
                    date: "2022-05-11",
                    board: "544305352414400504040110155101251434",
                    text: ""
                },
                114: {
                    type: "level",
                    date: "2022-05-10",
                    board: "1001544050012441",
                    text: ""
                },
                115: {
                    type: "level",
                    date: "2022-05-09",
                    board: "1123101132311032",
                    text: ""
                },
                116: {
                    type: "level",
                    date: "2022-05-08",
                    board: "1846202610402201418220436",
                    text: ""
                },
                117: {
                    type: "level",
                    date: "2022-05-07",
                    board: "1505460034626522",
                    text: ""
                },
                118: {
                    type: "level",
                    date: "2022-05-06",
                    board: "3582634402111830",
                    text: ""
                },
                119: {
                    type: "level",
                    date: "2022-05-05",
                    board: "3003584040262033",
                    text: ""
                },
                120: {
                    type: "level",
                    date: "2022-05-04",
                    board: "010503500031311400512330300103205413",
                    text: ""
                },
                121: {
                    type: "level",
                    date: "2022-05-03",
                    board: "0014250430410420",
                    text: ""
                },
                122: {
                    type: "level",
                    date: "2022-05-02",
                    board: "1203301113303210",
                    text: ""
                },
                123: {
                    type: "level",
                    date: "2022-05-01",
                    board: "1242621642504420243362535",
                    text: ""
                },
                124: {
                    type: "level",
                    date: "2022-04-30",
                    board: "1815250844310580",
                    text: ""
                },
                125: {
                    type: "level",
                    date: "2022-04-29",
                    board: "8010416081041110",
                    text: ""
                },
                126: {
                    type: "level",
                    date: "2022-04-28",
                    board: "3438451208004400",
                    text: ""
                },
                127: {
                    type: "level",
                    date: "2022-04-27",
                    board: "0214141316530010",
                    text: ""
                },
                128: {
                    type: "level",
                    date: "2022-04-26",
                    board: "1050211105055540",
                    text: ""
                },
                129: {
                    type: "level",
                    date: "2022-04-25",
                    board: "1130021110021130311331112",
                    text: ""
                },
                130: {
                    type: "level",
                    date: "2022-04-24",
                    board: "1144331223826116054262065",
                    text: ""
                },
                131: {
                    type: "level",
                    date: "2022-04-23",
                    board: "6410401340602002",
                    text: ""
                },
                132: {
                    type: "level",
                    date: "2022-04-22",
                    board: "5121382480150100",
                    text: ""
                },
                133: {
                    type: "level",
                    date: "2022-04-21",
                    board: "0551803631310053",
                    text: ""
                },
                134: {
                    type: "level",
                    date: "2022-04-20",
                    board: "1213105821113040",
                    text: ""
                },
                135: {
                    type: "level",
                    date: "2022-04-19",
                    board: "3110513040032155",
                    text: ""
                },
                136: {
                    type: "level",
                    date: "2022-04-18",
                    board: "3322331302111311212121300",
                    text: ""
                },
                137: {
                    type: "level",
                    date: "2022-04-17",
                    board: "0414514015581181350551411",
                    text: ""
                },
                138: {
                    type: "level",
                    date: "2022-04-16",
                    board: "2206054520048200",
                    text: ""
                },
                139: {
                    type: "level",
                    date: "2022-04-15",
                    board: "0204230383065054",
                    text: ""
                },
                140: {
                    type: "level",
                    date: "2022-04-14",
                    board: "8034300011230232",
                    text: ""
                },
                141: {
                    type: "level",
                    date: "2022-04-13",
                    board: "0315025163040152",
                    text: ""
                },
                142: {
                    type: "level",
                    date: "2022-04-12",
                    board: "0500512204102351",
                    text: ""
                },
                143: {
                    type: "level",
                    date: "2022-04-11",
                    board: "1310123120222303",
                    text: ""
                },
                144: {
                    type: "level",
                    date: "2022-04-10",
                    board: "6134051306160353030065023",
                    text: ""
                },
                145: {
                    type: "level",
                    date: "2022-04-09",
                    board: "3406106584145150",
                    text: ""
                },
                146: {
                    type: "level",
                    date: "2022-04-08",
                    board: "8151114661311330",
                    text: ""
                },
                147: {
                    type: "action",
                    func: r1
                }
            }
        }
    };

    function simple_parse_date(e) {
        var t = {},
            a = e.split("-");
        return [t.year, t.month, t.day] = [1 * a[0], 1 * a[1], 1 * a[2]], t
    }

    function simple_get_date() {
        var e = new Date,
            t = e.getFullYear() + "",
            a = e.getMonth() + 1 + "",
            s = e.getDate() + "";
        return [t, a = a.length < 2 ? "0" + a : a, s = s.length < 2 ? "0" + s : s].join("-")
    }

    function compare_date(e, t) {
        return (new Date(e) - new Date(t)) / 864e5
    }

    function solve(e, t = !1) {
        var a = e.split(""),
            s = Math.sqrt(a.length),
            o = [];
        for (i = 0; i < s ** 2; i++) this_type = parseInt(a[i], 10), o.push({
            id: i,
            type: this_type,
            eff_type: this_type,
            on: 1,
            self: 0,
            extend: 0,
            mutual: [],
            mutual_rot: [],
            mutual_unrot: [],
            rotate: 0,
            sol: 0,
            answer: 0
        });
        o = explanation_layer(solution_layer(bridge_layer(behavior_layer(o))));
        for (var l = [], r = [], n = [], i = 0; i < o.length; i++) o[i].sol > 0 ? l.push(i) : 0 == o[i].sol && r.push(i);
        l.length > 0 ? n = l : r.length > 0 && (n = r);
        for (var u = 0; u < n.length; u++) o[n[u]].answer = 1;
        return t || (window.squares = o), n
    }

    function flip_solve(e) {
        var t = [];
        return solve(e.split("").reverse().join(""), !0).forEach((a => t.push(Math.abs(e.length - 1) - a))), t.sort(), t
    }

    function behavior_layer(e) {
        for (var t = 1, a = 0, s = build_pairs(e), o = 0; 0 != t;) {
            o++, t = 0;
            var l = [],
                r = [];
            for (var n in s)[e, s, l[n], r[n]] = calculate_effect(e, s, n), t += r[n];
            for (var i in s) 0 != r[i] && ([e, s] = apply_effect(e, s, l[i], i));
            if (0 == t && 0 == a && (t = -1, a = 1), o > 50) return console.log("too many cycles"), window.broken = e, []
        }
        return e.behavior_pairs = s, e
    }

    function build_pairs(e) {
        var t = [];
        const a = get_beh_sq(e);
        for (var s = 0; s < a.length; s++) {
            t.push({
                alpha: a[s],
                beta: a[s],
                adjacent: 2,
                rotate: 0,
                effect: "",
                tagback: [],
                change: 0
            });
            let r = get_all(e, a[s], 1, 0),
                n = get_adjacents(e, a[s], 1, 0);
            for (var o = 0; o < r.length; o++) {
                var l = n.includes(r[o]) ? 1 : 0;
                t.push({
                    alpha: a[s],
                    beta: r[o],
                    adjacent: l,
                    rotate: 0,
                    effect: "",
                    tagback: [],
                    change: 0
                })
            }
            let i = get_all(e, a[s], 1, 1),
                u = get_adjacents(e, a[s], 1, 1);
            for (o = 0; o < i.length; o++) {
                l = u.includes(i[o]) ? 1 : 0, t.push({
                    alpha: a[s],
                    beta: i[o],
                    adjacent: l,
                    rotate: 1,
                    effect: "",
                    tagback: [],
                    change: 0
                })
            }
        }
        return t
    }

    function solution_layer(e) {
        for (var t = build_solution_pairs(e), a = 0; a < t.length; a++) {
            var s = t[a];
            e[s.alpha].on < 1 || 0 == s.adjacent && e[s.alpha].extend < 1 || s.alpha == s.beta && e[s.alpha].self < 1 ? t[a].effect = null : 2 == e[s.alpha].eff_type ? (e[s.beta].sol++, t[a].effect = "green") : 1 == e[s.alpha].eff_type && (e[s.beta].sol--, t[a].effect = "red")
        }
        return e.solution_pairs = t, e
    }

    function build_solution_pairs(e) {
        var t = [];
        const a = get_sol_sq(e);
        for (var s = 0; s < a.length; s++) {
            var o = get_all(e, a[s]);
            o.push(a[s]);
            let n = get_adjacents(e, a[s]);
            for (var l = 0; l < o.length; l++) {
                var r;
                r = a[s] == o[l] ? 2 : n.includes(o[l]) ? 1 : 0, t.push({
                    alpha: a[s],
                    beta: o[l],
                    adjacent: r
                })
            }
        }
        return t
    }

    function bridge_layer(e) {
        bridge_pairs = build_bridge_pairs(e);
        for (var t = 0; t < bridge_pairs.length; t++) {
            var a = bridge_pairs[t];
            e[a.alpha].on < 1 || 0 == a.adjacent && e[a.alpha].extend < 1 ? bridge_pairs[t].effect = null : 6 == e[a.alpha].eff_type ? (e[a.beta].eff_type = flip_table[e[a.beta].eff_type], bridge_pairs[t].effect = "flip") : 5 == e[a.alpha].eff_type ? (e[a.beta].self++, bridge_pairs[t].effect = "self") : 4 == e[a.alpha].eff_type ? (e[a.beta].extend++, bridge_pairs[t].effect = "extend") : 3 == e[a.alpha].eff_type ? (e[a.beta].on--, bridge_pairs[t].effect = "off") : 7 == e[a.alpha].eff_type ? (e[a.beta].on++, bridge_pairs[t].effect = "on") : 8 == e[a.alpha].eff_type ? (e[a.beta].rotate++, bridge_pairs[t].effect = "rotate") : 9 == e[a.alpha].eff_type && (e[a.beta].rotate--, bridge_pairs[t].effect = "unrotate")
        }
        return e.bridge_pairs = bridge_pairs, e
    }

    function build_bridge_pairs(e) {
        var t = [];
        const a = get_beh_sq(e);
        for (var s = 0; s < a.length; s++) {
            var o = get_all(e, a[s], 2);
            let n = get_adjacents(e, a[s], 2);
            for (var l = 0; l < o.length; l++) {
                var r;
                r = n.includes(o[l]) ? 1 : 0, t.push({
                    alpha: a[s],
                    beta: o[l],
                    adjacent: r
                })
            }
        }
        return t
    }

    function mutual_off(e, t, a) {
        if (3 == e[t].eff_type && 3 == e[a].eff_type) {
            if (get_adjacents(e, t).includes(a) && get_adjacents(e, a).includes(t)) return -1 == e[t].mutual.indexOf(a) && e[t].mutual.push(a), -1 == e[a].mutual.indexOf(t) && e[a].mutual.push(t), !0;
            if (get_all(e, t).includes(a) && get_all(e, a).includes(t) && e[t].extend > 0 && e[a].extend > 0) return -1 == e[t].mutual.indexOf(a) && e[t].mutual.push(a), -1 == e[a].mutual.indexOf(t) && e[a].mutual.push(t), !0;
            if (t == a && e[t].self > 0) return -1 == e[t].mutual.indexOf(a) && e[t].mutual.push(a), !0
        }
        return !1
    }

    function mutual_rotate(e, t, a) {
        if (8 == e[t].eff_type && e[t].on > 0 && 8 == e[a].eff_type && e[a].on > 0) {
            if (get_adjacents(e, t).includes(a) && get_adjacents(e, a).includes(t)) return -1 == e[t].mutual_rot.indexOf(a) && e[t].mutual_rot.push(a), -1 == e[a].mutual_rot.indexOf(t) && e[a].mutual_rot.push(t), !0;
            if (get_all(e, t).includes(a) && get_all(e, a).includes(t) && e[t].extend > 0 && e[a].extend > 0) return -1 == e[t].mutual_rot.indexOf(a) && e[t].mutual_rot.push(a), -1 == e[a].mutual_rot.indexOf(t) && e[a].mutual_rot.push(t), !0;
            if (t == a && e[t].self > 0) return -1 == e[t].mutual_rot.indexOf(a) && e[t].mutual_rot.push(a), !0
        }
        return !1
    }

    function mutual_unrotate(e, t, a) {
        if (9 == e[t].eff_type && e[t].on && e[a].eff_type && 9 == e[a].on) {
            if (get_adjacents(e, t).includes(a)) return -1 == e[t].mutual_unrot.indexOf(a) && e[t].mutual_unrot.push(a), -1 == e[a].mutual_unrot.indexOf(t) && e[a].mutual_unrot.push(t), !0;
            if (get_all(e, t).includes(a) && e[t].extend > 0 && get_all(e, t).includes(a) && e[a].extend > 0) return -1 == e[t].mutual_unrot.indexOf(a) && e[t].mutual_unrot.push(a), -1 == e[a].mutual_unrot.indexOf(t) && e[a].mutual_unrot.push(t), !0;
            if (t == a && e[t].self > 0) return -1 == e[t].mutual_unrot.indexOf(a) && e[t].mutual_unrot.push(a), !0
        }
        return !1
    }

    function alignment(e, t, a) {
        return e[t].rotate > 0 && e[a].rotate > 0 || e[t].rotate < 1 && e[a].rotate < 1
    }

    function calculate_effect(e, t, a) {
        var s = t[a],
            o = s.effect,
            l = "",
            r = find_pair(t, s.beta, s.alpha);
        return s.tagback.includes(s.beta) ? l = 0 : "mutual_rotate" == o ? (e[s.alpha].rotate -= e[s.alpha].mutual_rot.length, e[s.beta].rotate -= e[s.beta].mutual_rot.length, mutual_rotate(e, s.alpha, s.beta) ? l = "mutual_rotate" : (l = 0, e[s.alpha].mutual_rot.filter((e => e != s.beta)), e[s.beta].mutual_rot.filter((e => e != s.alpha))), e[s.alpha].rotate += e[s.alpha].mutual_rot.length, e[s.beta].rotate += e[s.beta].mutual_rot.length) : "mutual_unrotate" == o ? (e[s.alpha].rotate += e[s.alpha].mutual_unrot.length, e[s.beta].rotate += e[s.beta].mutual_unrot.length, mutual_unrotate(e, s.alpha, s.beta) ? l = "mutual_unrotate" : (l = 0, e[s.alpha].mutual_unrot.filter((e => e != s.beta)), e[s.beta].mutual_unrot.filter((e => e != s.alpha))), e[s.alpha].rotate -= e[s.alpha].mutual_unrot.length, e[s.beta].rotate -= e[s.beta].mutual_unrot.length) : 1 == s.rotate && e[s.alpha].rotate < 1 || 0 == s.rotate && e[s.alpha].rotate > 0 && s.alpha != s.beta || 6 == e[s.beta].eff_type && [5, 6].includes(e[s.alpha].eff_type) ? l = 0 : mutual_off(e, s.alpha, s.beta) && e[s.alpha].on + e[s.alpha].mutual.length > 0 ? l = "off" : mutual_rotate(e, s.alpha, s.beta) ? l = "mutual_rotate" : mutual_unrotate(e, s.alpha, s.beta) ? l = "mutual_unrotate" : e[s.alpha].on < 1 || s.alpha == s.beta && e[s.alpha].self < 1 || alignment(e, s.alpha, s.beta) && 1 == s.adjacent && !check_precedence(e, s.alpha, s.beta) || alignment(e, s.alpha, s.beta) && !t[r].tagback.includes(s.alpha) && 0 == s.adjacent && e[s.alpha].extend > 0 && e[s.beta].extend > 0 && !check_precedence(e, s.alpha, s.beta) || 0 == s.adjacent && e[s.alpha].extend < 1 ? l = 0 : 3 == e[s.alpha].eff_type ? l = "off" : 4 == e[s.alpha].eff_type ? (l = "extend", s.adjacent < 1 && !t[r].tagback.includes(s.alpha) && t[r].tagback.push(s.alpha)) : 5 == e[s.alpha].eff_type ? l = "self" : 6 == e[s.alpha].eff_type ? l = "flip" : 7 == e[s.alpha].eff_type ? l = "on" : 8 == e[s.alpha].eff_type ? l = "rotate" : 9 == e[s.alpha].eff_type && (l = "unrotate"), [e, t, l, l == o ? 0 : 1]
    }

    function apply_effect(e, t, a, s) {
        var o = t[s],
            l = find_pair(t, o.beta, o.alpha);
        switch (o.effect) {
            case "off":
                e[o.beta].on++;
                break;
            case "extend":
                e[o.beta].extend--, t[l].tagback = t[l].tagback.filter((e => e != o.alpha));
                break;
            case "self":
                e[o.beta].self--;
                break;
            case "flip":
                e[o.beta].eff_type = flip_table[e[o.beta].eff_type];
                break;
            case "on":
                e[o.beta].on--;
                break;
            case "rotate":
                e[o.beta].rotate--;
                break;
            case "unrotate":
                e[o.beta].rotate++;
                break;
            case "mutual_rotate":
                e[o.beta].rotate--, e[o.alpha].rotate--, t[l].effect = 0;
                break;
            case "mutual_unrotate":
                e[o.beta].rotate++, e[o.alpha].rotate++, t[l].effect = 0
        }
        switch (a) {
            case "off":
                e[o.beta].on--;
                break;
            case "extend":
                e[o.beta].extend++;
                break;
            case "self":
                e[o.beta].self++;
                break;
            case "flip":
                e[o.beta].eff_type = flip_table[e[o.beta].eff_type];
                break;
            case "on":
                e[o.beta].on++;
                break;
            case "rotate":
                e[o.beta].rotate++;
                break;
            case "unrotate":
                e[o.beta].rotate--;
                break;
            case "mutual_rotate":
                e[o.beta].rotate++, e[o.alpha].rotate++, t[l].effect = "mutual_rotate";
                break;
            case "mutual_unrotate":
                e[o.beta].rotate--, e[o.alpha].rotate--, t[l].effect = "mutual_unrotate"
        }
        return t[s].effect = a, [e, t]
    }

    function find_pair(e, t, a) {
        for (var s in e)
            if (e[s].alpha == t && e[s].beta == a) return s
    }

    function get_adjacents(e, t, a = 0, s = -1) {
        const o = get_beh_sq(e),
            l = get_sol_sq(e),
            r = Math.sqrt(e.length);
        let n = [];
        if (-1 == s && (s = e[t].rotate), s < 1)(t + 1) % r != 1 && n.push(t - 1), t >= r && n.push(t - r), (t + 1) % r != 0 && n.push(t + 1), t + r < r ** 2 && n.push(t + r);
        else if (s >= 1)
            for (var i = t % r, u = Math.floor(t / r), p = 0; p < r; p++)
                for (var d = 0; d < r; d++) 1 == Math.abs(p - i) && 1 == Math.abs(d - u) && n.push(d * r + p);
        switch (a) {
            case 0:
                break;
            case 1:
                n = n.filter((e => o.includes(e)));
                break;
            case 2:
                n = n.filter((e => l.includes(e)))
        }
        return n
    }

    function get_all(e, t, a = 0, s = -1) {
        const o = get_beh_sq(e),
            l = get_sol_sq(e),
            r = Math.sqrt(e.length);
        let n = [];
        if (-1 == s && (s = e[t].rotate), s < 1) {
            let e = Math.floor(t / r) * r,
                a = t - e;
            for (var i = e; i < e + r; i++) i !== t && n.push(i);
            for (i = 0; i < r; i++) {
                (d = i * r + a) !== t && n.push(d)
            }
        } else if (s >= 1) {
            var u = t % r,
                p = Math.floor(t / r);
            for (i = 0; i < r; i++)
                for (var d = 0; d < r; d++) Math.abs(i - u) == Math.abs(d - p) && Math.abs(d - p) > 0 && n.push(d * r + i)
        }
        switch (a) {
            case 0:
                break;
            case 1:
                n = n.filter((e => o.includes(e)));
                break;
            case 2:
                n = n.filter((e => l.includes(e)))
        }
        return n
    }

    function check_precedence(e, t, a) {
        return precedence[e[t].eff_type] >= precedence[e[a].eff_type]
    }

    function explanation_layer(e) {
        var t = [];
        return [e.behavior_pairs, e.bridge_pairs, e.solution_pairs].forEach((function(e, a) {
            (e = e || []).forEach((function(e, a) {
                e.effect && t.push({
                    alpha: e.alpha,
                    beta: e.beta,
                    effect: "mutual_rotate" == e.effect ? "rotate" : "mutual_unrotate" == e.effect ? "unrotate" : e.effect
                })
            }))
        })), e.explain_pairs = t, e
    }

    function explain_link(e, t) {
        return "<span square='" + t + "' class='explain_link text_" + e[t].type + "'>" + (t + 1) + "</span>"
    }

    function explain_square(e, t) {
        const a = {
            1: "red",
            2: "green",
            3: "yellow",
            4: "purple",
            5: "blue",
            6: "pink",
            7: "anti-yellow",
            8: "orange",
            9: "anti-orange"
        };
        var s = {};
        ["green", "red", "off", "on", "extend", "self", "flip", "rotate", "unrotate"].forEach((e => s[e] = []));
        var o = [],
            l = {};
        e.explain_pairs.filter((e => e.beta == t)).forEach((t => s[t.effect].push(explain_link(e, t.alpha)))), e.explain_pairs.filter((e => e.alpha == t)).forEach((t => o.push(explain_link(e, t.beta))));
        return l.off = s.off.length > 0 ? "Switched off by: " + s.off.join(", ") + "<br/>" : "", l.on = s.on.length > 0 ? "Switched on by: " + s.on.join(", ") + "<br/>" : "", l.on_final = "Square is " + (e[t].on > 0 ? "on" : "off"), l.extend = (s.extend.length > 0 ? "Extended by: " + s.extend.join(", ") : "Not extended") + "<br/>", l.self = (s.self.length > 0 ? "Touches self because of: " + s.self.join(", ") : "Does not touch itself") + "<br/>", l.flip = s.flip.length > 0 ? "Flipped by: " + s.flip.join(", ") + "<br/>" : "", l.flipped_final = s.flip.length < 1 ? "Square is not flipped" : s.flip.length % 2 == 1 ? "Square is flipped to " + a[e[t].eff_type] : "Square flipped back to " + a[e[t].eff_type], l.rotate = s.rotate.length > 0 ? "Turned by: " + s.rotate.join(", ") + "<br/>" : "", l.unrotate = s.unrotate.length > 0 ? "Turned back by: " + s.unrotate.join(", ") + "<br/>" : "", l.rotate_final = "Square is " + (e[t].rotate > 0 ? "turned" : "not turned"), l.green = (s.green.length > 0 ? "Touched by greens: " + s.green.join(", ") : "Not touched by greens") + "<br/>", l.red = (s.red.length > 0 ? "Touched by reds: " + s.red.join(", ") : "Not touched by reds") + "<br/>", l.answer = "Square is " + (e[t].answer > 0 ? "a solution!" : "not a solution"), l.touched = o.length > 0 ? o.join(", ") : "None", $("#explain_left").html("<p><strong><span class='text_3'>On/Off</span></strong><br/>" + l.off + l.on + l.on_final + "</p><p><strong><span class='text_4'>Extend</span> + <span class='text_5'>Self</span></strong><br/>" + l.extend + l.self + "</p><p><strong><span class='text_8'>Turn</span></strong><br/>" + l.rotate + l.unrotate + l.rotate_final + "</p>"), $("#explain_right").html("<p><strong><span class='text_6'>Flip</span></strong><br/>" + l.flip + l.flipped_final + "</p><p><strong><span class='text_1'>Red</span> + <span class='text_2'>Green</span></strong><br/>" + l.green + l.red + l.answer + "</p><p><strong>Touches: </strong>" + l.touched + "</p>"), l
    }

    function create_board(e) {
        var t = "",
            a = [];
        for (var s in freqs)
            for (o = 0; o < freqs[s]; o++) a.push(s);
        for (var o = 0; o < e ** 2; o++) t += a[Math.floor(Math.random() * a.length)];
        return t
    }

    function enter_guess(e) {
        answer = $("#square_" + e).attr("answer"), corrects = 0, gameboard_size = Math.sqrt(board.length);
        var t, a = 1 / gameboard_size / .05,
            s = Math.floor(e / gameboard_size),
            o = e % gameboard_size,
            l = 100 / gameboard_size,
            r = (1 + o) * l - a - 3,
            n = (1 + s) * l - a - 3,
            i = document.getElementById("gameboard");
        for (var u in guess_counter = guesses.length + " attempt" + (1 == guesses.length ? "." : "s."), window.final) guesses.includes(window.final[u]) && corrects++;
        1 == answer ? (t = "svg_check", corrects == window.final.length ? ($("#random").addClass("engage"), $("#answer_bar").css("display", ""), corrects == guesses.length ? (msg = "<span class='correct'>Perfect!</span>", sparkle()) : (msg = "<span class='correct'>Complete.</span>", $("#logo_green").fadeIn(300))) : (msg = "<span class='correct'>Correct.</span>", $("#logo_white").toggle(), $("#logo_green").toggle().delay(200).fadeOut(300), $("#logo_white").toggle())) : ($("#logo_white").toggle(), $("#logo_red").toggle().delay(200).fadeOut(300), $("#logo_white").toggle(), t = "svg_x", msg = "<span class='incorrect'>Incorrect.</span>"), i.insertAdjacentHTML("beforeend", $("#" + t).html()), $("#new_x").attr("id", "indicator_" + e), $("#indicator_" + e).attr({
            width: a + "%",
            height: a + "%",
            x: r + "%",
            y: n + "%"
        }), msg += " " + guess_counter + " " + corrects + "/" + window.final.length + " correct.", $("#answer_bar").html(msg)
    }

    function get_beh_sq(e) {
        var t = [];
        return e.forEach((function(e) {
            behavior_types.includes(e.type) && t.push(e.id)
        })), t
    }

    function get_sol_sq(e) {
        var t = [];
        return e.forEach((function(e) {
            solution_types.includes(e.type) && t.push(e.id)
        })), t
    }

    function setup(e = null) {
        $("#random").removeClass("engage"), solutions = null, corrects = 0;
        var t = "level",
            a = [];
        if (1 == levels) {
            $("#level_text").show(), level_buttons();
            var s = level_packs[level_pos.pack].path[level_pos.step];
            switch (s.type) {
                case "level":
                    e = s.board, l = solve(e), board_size = Math.sqrt(e.length), $("#level_text").html(s.text), popup_off();
                    break;
                case "action":
                    s.func(), t = "action"
            }
        } else if (0 == levels)
            if ($("#level_text").hide(), 0 == edit && free_play(), e) l = solve(e), a = flip_solve(e), l.every((e => a.includes(e))) && a.every((e => l.includes(e))) || (solutions = "Unsolvable"), board_size = Math.sqrt(e.length);
            else
                for (var o = 0; 0 == o;) {
                    o = 1, board_size = window.size;
                    var l = solve(e = create_board(board_size));
                    a = flip_solve(e);
                    l.length < 1 || 0 == edit && 0 == levels && board_size > 2 && board_size < 7 && (l.length > max_sol || l.length < 1) ? o = 0 : l.every((e => a.includes(e))) && a.every((e => l.includes(e))) || (1 == edit ? solutions = "Unsolvable." : 0 == edit && (o = 0))
                }
        if ("level" == t) {
            history.pushState({
                page: 1
            }, "title 1", "?" + e), solutions = solutions || l.length + " solution" + (1 != l.length ? "s" : ""), $("#gameboard").html(""), window.guesses = [], window.board = e, window.final = l, $(".logo_letter").css("fill", "#FFFFE7"), $("#logo_green").css("display", "none");
            for (var r = 0; r < e.length; r++) {
                var n = l.includes(r) ? 1 : 0,
                    i = Math.floor(r / board_size),
                    u = r % board_size,
                    p = 100 / board_size,
                    d = p - 2;
                let t = 1 + u * p,
                    a = 1 + i * p,
                    s = "<rect answer='" + n + "' class='type_" + e[r] + " box' number='" + r + "' id='square_" + r + "' x=" + t + "% y=" + a + "% width=" + d + "% height=" + d + "%></rect>",
                    o = "<text x='" + (t + 3) + "%' y='" + (a + 6) + "%' class='number_text'>" + (r + 1) + "</text>",
                    c = "<text x='" + (t + d - 7) + "%' y='" + (a + 6) + "%' class='label_text text_120'>" + ["W", "R", "G", "Y", "Pu", "B", "Pi", "", "O"][e[r]] + "</text>";
                document.getElementById("gameboard").insertAdjacentHTML("beforeend", s + o + c)
            }
            var c = board_category(e);
            $("#daily_bar").html("daily" == c[0] ? "<span style='white-space:pre'>Daily: " + day_str(c[2], "simple") + "  </span>" : ""), 0 == show_solution_count ? $("#answer_bar").css("display", "none") : $("#answer_bar").css("display", ""), $("#answer_bar").html(solutions), find_level(e) >= 0 && (guesses = load_guesses(find_level(e))).forEach((e => enter_guess(e)))
        }
        return draw_dots(e), sizing(), number_text ? $(".number_text").show() : $(".number_text").hide(), label_text ? $(".label_text").show() : $(".label_text").hide(), rules ? $("#rules").show() : $("#rules").hide(), l
    }

    function draw_dots(e) {
        var t = "",
            a = ["0", "1", "2", "3", "4", "5", "8", "6"].filter((t => e.split("").includes(t)));
        a.forEach((function(e, s) {
            t += "<circle number='" + e + "' cx=" + (s + 1) * (100 / (a.length + 1)) + "% cy=50% r=4.5% class='rules_dot type_" + e + "' />", t += "<text class='label_text' x=" + ((s + 1) * (100 / (a.length + 1)) - [1.98, 1.5, 1.5, 1.35, 2.45, 1.3, 1.8, 0, 1.6][a[s]]) + "% y=61%>" + ["W", "R", "G", "Y", "Pu", "B", "Pi", "", "O"][a[s]] + "</text>"
        })), $("#dots").html(t)
    }
    $(document).ready((function() {
        free_play(), window.final = setup(window.location.search.substr(1) ? window.location.search.substr(1) : null), 1 == show_welcome && welcome(), $("#logo_svg").toggle(), $("body").on("click", ".difficulty_button", (function() {
            apply_difficulty($(this).attr("difficulty")), levels = 0, free_play(), popup_off(), setup(null)
        })), $("body").on("click", ".settings_launch", (function() {
            settings()
        })), $("body").on("click", ".daily", (function() {
            for (var e in level_packs[2].path) 0 == compare_date(level_packs[2].path[e].date, simple_get_date()) && setup(level_packs[2].path[e].board)
        })), $("body").on("click", "#import_button", (function() {
            import_history_go(), popup_off()
        })), $("body").on("click", "#explain_menu", (function() {
            explain_off(), sizing()
        })), $("body").on("click", ".menu_row", (function() {
            var e = $(this).attr("target");
            switch ($(this).attr("action")) {
                case "toggle_solution_count":
                    switch (parseInt(show_solution_count)) {
                        case 0:
                            show_solution_count = 1, $(e).addClass("checked"), $("#answer_bar").css("display", "");
                            break;
                        case 1:
                            show_solution_count = 0, $("#answer_bar").css("display", "none"), $(e).removeClass("checked")
                    }
                    localStorage.setItem("show_solution_count", show_solution_count);
                    break;
                case "toggle_welcome":
                    switch (parseInt(show_welcome)) {
                        case 0:
                            show_welcome = 1, $(e).addClass("checked"), localStorage.setItem("show_welcome", show_welcome);
                            break;
                        case 1:
                            show_welcome = 0, $(e).removeClass("checked"), localStorage.setItem("show_welcome", show_welcome)
                    }
                    break;
                case "show_rules":
                    switch (parseInt(rules)) {
                        case 0:
                            rules = 1, $(e).addClass("checked"), $("#rules").show(), localStorage.setItem("rules", rules);
                            break;
                        case 1:
                            rules = 0, $("#rules").hide(), $(e).removeClass("checked"), localStorage.setItem("rules", rules)
                    }
                    break;
                case "show_numbers":
                    switch (parseInt(number_text)) {
                        case 0:
                            number_text = 1, $(e).addClass("checked"), $(".number_text").show(), localStorage.setItem("number_text", number_text);
                            break;
                        case 1:
                            number_text = 0, $(".number_text").hide(), $(e).removeClass("checked"), localStorage.setItem("number_text", number_text)
                    }
                    break;
                case "show_labels":
                    switch (parseInt(label_text)) {
                        case 0:
                            label_text = 1, $(e).addClass("checked"), $(".label_text").show(), localStorage.setItem("label_text", label_text);
                            break;
                        case 1:
                            label_text = 0, $(".label_text").hide(), $(e).removeClass("checked"), localStorage.setItem("label_text", label_text)
                    }
                    break;
                case "settings":
                    settings();
                    break;
                case "daily":
                    daily_menu(), sizing();
                    break;
                case "history":
                    history_menu(), sizing();
                    break;
                case "stats":
                    stats(), sizing();
                    break;
                case "create":
                    edit_toggle(), popup_off();
                    break;
                case "explain":
                    edit = 0, explain = 1, popup_off(), explain_on(), sizing();
                    break;
                case "free_play":
                    levels = 0, free_play(), popup_off(), setup();
                    break;
                case "clear_history":
                    clear_history();
                    break;
                case "export_history":
                    export_history();
                    break;
                case "import_history":
                    import_history();
                    break;
                case "about":
                    window.open("https://www.notion.so/Squares-baa66521ee8643b29a14ce2085a0650f", "_blank")
            }
        })), $("body").on("click", "#show_welcome", (function() {
            show_welcome = 0 == show_welcome ? 1 : 0, localStorage.setItem("show_welcome", show_welcome)
        })), $("body").on("change", ".freq_slider", (function() {
            freqs[$(this).attr("number")] = parseInt($(this).val(), 10), localStorage.setItem("freqs", JSON.stringify(freqs))
        })), $("body").on("change", "#board_size", (function() {
            window.size = parseInt($(this).val(), 10), $("#max_sol_row").html(max_solutions_select()), sizing(), localStorage.setItem("size", window.size)
        })), $("body").on("change", "#max_sol", (function() {
            max_sol = parseInt($(this).val(), 10), localStorage.setItem("max_sol", max_sol)
        })), $("body").on("click", ".tutorial_launch", (function() {
            edit = 0, level_pos.pack = 1, level_packs[level_pos.pack].path[0].func(), sizing()
        })), $("body").on("click", "#play", (function() {
            edit_toggle()
        })), $("body").on("click", ".explain_link", (function() {
            explain_square(squares, parseInt($(this).attr("square"))), $(".box").css("opacity", .3), $("#square_" + $(this).attr("square")).css("opacity", 1)
        })), $("body").on("mouseover", ".explain_link", (function() {
            $(this).attr("original_opacity", $("#square_" + $(this).attr("square")).css("opacity")), $("#square_" + $(this).attr("square")).css("opacity", 1)
        })), $("body").on("mouseout", ".explain_link", (function() {
            $("#square_" + $(this).attr("square")).css("opacity", $(this).attr("original_opacity"))
        })), $("body").on("click", ".rules_dot", (function() {
            popup_size = "large", $("#popup_content").html(rules_text[$(this).attr("number")]), popup_on(), sizing()
        })), $("#overlay").click((function() {
            popup_off()
        })), $("body").on("click", "#next", (function() {
            level_pos.step++, window.final = setup()
        })), $("body").on("click", "#prev", (function() {
            level_pos.step--, window.final = setup()
        })), $("body").on("click", "#levels_menu", (function() {
            level_packs[level_pos.pack].path[0].func(), sizing()
        })), $("#levels_off").click((function() {
            levels = 0, window.final = setup()
        })), $("body").on("click", ".preset", (function() {
            for (var e = $(this).attr("preset"), t = 0; t < preset_lib[e].length; t++) $("#slider_" + t).val(preset_lib[e][t]).trigger("change");
            1 == levels && (levels = 0)
        })), $("body").on("click", ".pack_menu_item", (function() {
            var e = $(this).attr("pack_number");
            level_pos.pack = e, window.final = setup()
        })), $("body").on("click", ".level_menu_item", (function() {
            levels = 1, level_buttons();
            var e = $(this).attr("step_number");
            level_pos.step = e, window.final = setup()
        })), $("body").on("click", ".daily_menu_item", (function() {
            board = $(this).attr("board"), levels = 0, window.final = setup(board), popup_off()
        })), $("body").on("click", ".history_menu_item", (function() {
            board = $(this).attr("board"), levels = 0, window.final = setup(board), popup_off()
        })), $("body").on("click", ".back_to_menu", (function() {
            level_pos.pack = 0, level_pos.step = 0, window.final = setup()
        })), $("body").on("click", ".begin_button, .popup_next", (function() {
            level_pos.step++, window.final = setup()
        })), $("body").on("click", "#menu", (function() {
            main_menu()
        })), $("#edit_toggle").click((function() {
            edit_toggle()
        })), $("body").on("click", "#random", (function() {
            window.final = setup(null)
        })), $("body").on("click", "#blank", (function() {
            let e = "";
            for (i = 0; i < size ** 2; i++) e += "0";
            edit_toggle(1), window.final = setup(e)
        })), $("body").on("click", "#share_button", (function() {
            var e = "",
                t = board_category(board);
            guesses.length > 0 && (e = guess_counter + " " + corrects + "/" + final.length + " correct."), navigator.share({
                title: "Squares",
                text: "#squaresgame " + ("daily" == t[0] ? "Daily: " + day_str(t[2], "simple") : "") + "\n" + solutions + ".\n" + e + "\nhttps://squaresga.me/?" + board
            })
        })), $("body").on("click", ".box", (function() {
            0 == edit && 0 == explain && corrects < window.final.length ? (number = $(this).attr("number"), guesses.push(parseInt(number, 10)), enter_guess(number), store_level()) : 1 == edit ? cycle_square($(this).attr("number")) : 1 == explain && (explain_square(squares, $(this).attr("number")), $(".box").css("opacity", .3), $("#square_" + $(this).attr("number")).css("opacity", 1))
        })), sizing()
    }));

</script>
</head>

<body>
  <!-- Our app-index web component. This component is defined in src/pages/app-index.ts-->
  <fluent-design-system-provider>
    <app-index></app-index>
  </fluent-design-system-provider>


<div class='popup' id='overlay'></div>
  <div class= 'popup' id='popup'><div id='popup_content'></div></div>
  <div id='container'>
    <div id='logo'>
      <svg id='logo_svg'version="1.0" xmlns="http://www.w3.org/2000/svg"
       width="100%" height='30px' viewBox="0 0 50.000000 650.000000"
       preserveAspectRatio="xMidYMid meet">



      <g id='logo_white' transform="translate(-960.000000,729.000000) scale(0.100000,-0.100000)"
      fill="#000000" stroke="none">
      <path id='test_letter' class='type_0 logo_letter' d="M2810 5069 c-171 -20 -335 -79 -441 -159 -166 -125 -237 -286 -225
      -510 10 -184 51 -287 160 -396 111 -110 208 -149 526 -209 161 -30 231 -61
      254 -109 20 -42 20 -57 1 -102 -22 -54 -85 -78 -189 -72 -128 7 -176 44 -186
      142 l-5 51 -283 3 -282 2 2 -261 3 -262 80 -24 c378 -114 822 -143 1106 -72
      142 36 242 90 331 179 58 57 85 94 107 144 109 242 67 558 -97 724 -103 105
      -215 152 -486 207 -229 46 -273 60 -313 100 -58 58 -37 139 44 166 48 16 174
      7 207 -15 36 -23 57 -58 63 -106 l6 -40 263 0 264 0 0 240 0 240 -37 19 c-194
      97 -592 152 -873 120z"/>
      <path class='type_0 logo_letter' d="M4475 5064 c-271 -49 -448 -253 -526 -604 -32 -147 -45 -369 -31
      -548 26 -326 104 -542 250 -689 131 -131 342 -194 547 -163 140 21 249 79 380
      202 l65 60 0 -206 0 -205 -117 -3 -118 -3 -3 -287 -2 -288 520 0 520 0 0 1065
      0 1065 75 0 75 0 0 285 0 285 -475 0 -475 0 0 -111 0 -111 -65 60 c-125 118
      -227 174 -355 198 -94 17 -163 16 -265 -2z m586 -630 c39 -20 77 -69 86 -112
      4 -20 8 -136 8 -257 0 -246 -5 -281 -42 -325 -39 -47 -79 -63 -154 -63 -83 0
      -136 27 -170 87 -24 40 -24 46 -24 301 0 254 1 261 23 301 39 66 110 97 202
      87 25 -3 57 -12 71 -19z"/>
      <path class='type_0 logo_letter' d="M9264 5070 c-151 -11 -321 -34 -476 -65 -67 -14 -122 -25 -124 -25
      -2 0 -4 -144 -4 -320 0 -261 2 -320 13 -320 8 0 40 9 73 20 297 103 747 125
      859 43 27 -20 59 -74 69 -115 l6 -26 -98 -6 c-506 -33 -783 -140 -926 -358
      -134 -203 -107 -541 54 -698 105 -102 277 -157 456 -146 181 12 301 64 426
      186 l78 75 0 -107 0 -108 460 0 460 0 0 285 0 285 -74 0 -74 0 -4 408 c-4 380
      -6 412 -26 487 -79 291 -273 442 -638 495 -100 14 -370 20 -510 10z m403
      -1234 c-9 -125 -61 -206 -142 -224 -133 -29 -216 95 -141 210 30 47 137 83
      250 87 l39 1 -6 -74z"/>
      <path class='type_0 logo_letter' d="M12051 5065 c-132 -25 -254 -104 -352 -228 l-39 -49 0 121 0 121
      -475 0 -475 0 0 -285 0 -285 75 0 75 0 -2 -392 -3 -393 -72 -3 -73 -3 0 -284
      0 -285 630 0 630 0 0 285 0 285 -155 0 -155 0 0 174 c0 269 29 377 126 466 54
      50 107 76 191 96 88 21 249 14 350 -15 40 -12 77 -21 83 -21 7 0 9 110 8 332
      l-3 332 -60 19 c-80 24 -212 30 -304 12z"/>
      <path class='type_0 logo_letter' d="M13377 5068 c-370 -38 -652 -224 -781 -516 -55 -126 -78 -241 -83
      -427 -11 -357 58 -588 230 -771 137 -147 303 -233 545 -281 121 -24 442 -24
      602 1 146 22 353 75 450 115 41 17 76 31 78 31 1 0 2 127 2 281 l0 281 -22 -5
      c-13 -2 -69 -16 -124 -31 -201 -52 -522 -83 -678 -65 -159 17 -236 89 -236
      222 l0 37 560 0 560 0 0 133 c-1 265 -29 418 -105 572 -128 259 -334 391 -660
      424 -123 12 -211 12 -338 -1z m255 -500 c73 -22 118 -98 118 -200 l0 -48 -195
      0 -195 0 0 51 c0 136 63 206 189 208 24 1 61 -4 83 -11z"/>
      <path class='type_0 logo_letter' d="M15250 5069 c-171 -20 -335 -79 -441 -159 -166 -125 -237 -286 -225
      -510 10 -184 51 -287 160 -396 111 -110 208 -149 526 -209 161 -30 231 -61
      254 -109 20 -42 20 -57 1 -102 -22 -54 -85 -78 -189 -72 -128 7 -176 44 -186
      142 l-5 51 -283 3 -282 2 2 -261 3 -262 80 -24 c378 -114 822 -143 1106 -72
      142 36 242 90 331 179 58 57 85 94 107 144 109 242 67 558 -97 724 -103 105
      -215 152 -486 207 -229 46 -273 60 -313 100 -58 58 -37 139 44 166 48 16 174
      7 207 -15 36 -23 57 -58 63 -106 l6 -40 263 0 264 0 0 240 0 240 -37 19 c-194
      97 -592 152 -873 120z"/>
      <path class='type_0 logo_letter' d="M6180 4745 l0 -285 75 0 75 0 0 -402 c0 -439 8 -540 54 -661 64 -170
      171 -271 341 -323 79 -24 271 -24 370 0 138 34 293 128 389 238 l46 53 0 -133
      0 -132 475 0 475 0 0 285 0 285 -75 0 -75 0 0 680 0 680 -495 0 -495 0 0 -285
      0 -285 96 0 95 0 -3 -322 c-3 -311 -4 -325 -26 -369 -31 -64 -84 -92 -171 -92
      -107 0 -170 47 -190 143 -7 34 -11 250 -11 630 l0 580 -475 0 -475 0 0 -285z"/>
      </g>

      <g id='logo_green' transform="translate(-960.000000,729.000000) scale(0.100000,-0.100000)"
      fill="#000000" stroke="none">
      <path id='logo_s' class='type_2' d="M2810 5069 c-171 -20 -335 -79 -441 -159 -166 -125 -237 -286 -225
      -510 10 -184 51 -287 160 -396 111 -110 208 -149 526 -209 161 -30 231 -61
      254 -109 20 -42 20 -57 1 -102 -22 -54 -85 -78 -189 -72 -128 7 -176 44 -186
      142 l-5 51 -283 3 -282 2 2 -261 3 -262 80 -24 c378 -114 822 -143 1106 -72
      142 36 242 90 331 179 58 57 85 94 107 144 109 242 67 558 -97 724 -103 105
      -215 152 -486 207 -229 46 -273 60 -313 100 -58 58 -37 139 44 166 48 16 174
      7 207 -15 36 -23 57 -58 63 -106 l6 -40 263 0 264 0 0 240 0 240 -37 19 c-194
      97 -592 152 -873 120z"/>
      <path id='logo_q' class='type_2' d="M4475 5064 c-271 -49 -448 -253 -526 -604 -32 -147 -45 -369 -31
      -548 26 -326 104 -542 250 -689 131 -131 342 -194 547 -163 140 21 249 79 380
      202 l65 60 0 -206 0 -205 -117 -3 -118 -3 -3 -287 -2 -288 520 0 520 0 0 1065
      0 1065 75 0 75 0 0 285 0 285 -475 0 -475 0 0 -111 0 -111 -65 60 c-125 118
      -227 174 -355 198 -94 17 -163 16 -265 -2z m586 -630 c39 -20 77 -69 86 -112
      4 -20 8 -136 8 -257 0 -246 -5 -281 -42 -325 -39 -47 -79 -63 -154 -63 -83 0
      -136 27 -170 87 -24 40 -24 46 -24 301 0 254 1 261 23 301 39 66 110 97 202
      87 25 -3 57 -12 71 -19z"/>
      <path id='logo_u' class='type_2' d="M9264 5070 c-151 -11 -321 -34 -476 -65 -67 -14 -122 -25 -124 -25
      -2 0 -4 -144 -4 -320 0 -261 2 -320 13 -320 8 0 40 9 73 20 297 103 747 125
      859 43 27 -20 59 -74 69 -115 l6 -26 -98 -6 c-506 -33 -783 -140 -926 -358
      -134 -203 -107 -541 54 -698 105 -102 277 -157 456 -146 181 12 301 64 426
      186 l78 75 0 -107 0 -108 460 0 460 0 0 285 0 285 -74 0 -74 0 -4 408 c-4 380
      -6 412 -26 487 -79 291 -273 442 -638 495 -100 14 -370 20 -510 10z m403
      -1234 c-9 -125 -61 -206 -142 -224 -133 -29 -216 95 -141 210 30 47 137 83
      250 87 l39 1 -6 -74z"/>
      <path id='logo_a' class='type_2' d="M12051 5065 c-132 -25 -254 -104 -352 -228 l-39 -49 0 121 0 121
      -475 0 -475 0 0 -285 0 -285 75 0 75 0 -2 -392 -3 -393 -72 -3 -73 -3 0 -284
      0 -285 630 0 630 0 0 285 0 285 -155 0 -155 0 0 174 c0 269 29 377 126 466 54
      50 107 76 191 96 88 21 249 14 350 -15 40 -12 77 -21 83 -21 7 0 9 110 8 332
      l-3 332 -60 19 c-80 24 -212 30 -304 12z"/>
      <path id='logo_r' class='type_2' d="M13377 5068 c-370 -38 -652 -224 -781 -516 -55 -126 -78 -241 -83
      -427 -11 -357 58 -588 230 -771 137 -147 303 -233 545 -281 121 -24 442 -24
      602 1 146 22 353 75 450 115 41 17 76 31 78 31 1 0 2 127 2 281 l0 281 -22 -5
      c-13 -2 -69 -16 -124 -31 -201 -52 -522 -83 -678 -65 -159 17 -236 89 -236
      222 l0 37 560 0 560 0 0 133 c-1 265 -29 418 -105 572 -128 259 -334 391 -660
      424 -123 12 -211 12 -338 -1z m255 -500 c73 -22 118 -98 118 -200 l0 -48 -195
      0 -195 0 0 51 c0 136 63 206 189 208 24 1 61 -4 83 -11z"/>
      <path id='logo_e' class='type_2' d="M15250 5069 c-171 -20 -335 -79 -441 -159 -166 -125 -237 -286 -225
      -510 10 -184 51 -287 160 -396 111 -110 208 -149 526 -209 161 -30 231 -61
      254 -109 20 -42 20 -57 1 -102 -22 -54 -85 -78 -189 -72 -128 7 -176 44 -186
      142 l-5 51 -283 3 -282 2 2 -261 3 -262 80 -24 c378 -114 822 -143 1106 -72
      142 36 242 90 331 179 58 57 85 94 107 144 109 242 67 558 -97 724 -103 105
      -215 152 -486 207 -229 46 -273 60 -313 100 -58 58 -37 139 44 166 48 16 174
      7 207 -15 36 -23 57 -58 63 -106 l6 -40 263 0 264 0 0 240 0 240 -37 19 c-194
      97 -592 152 -873 120z"/>
      <path id='logo_s2' class='type_2' d="M6180 4745 l0 -285 75 0 75 0 0 -402 c0 -439 8 -540 54 -661 64 -170
      171 -271 341 -323 79 -24 271 -24 370 0 138 34 293 128 389 238 l46 53 0 -133
      0 -132 475 0 475 0 0 285 0 285 -75 0 -75 0 0 680 0 680 -495 0 -495 0 0 -285
      0 -285 96 0 95 0 -3 -322 c-3 -311 -4 -325 -26 -369 -31 -64 -84 -92 -171 -92
      -107 0 -170 47 -190 143 -7 34 -11 250 -11 630 l0 580 -475 0 -475 0 0 -285z"/>
      </g>

      <g id='logo_red' transform="translate(-960.000000,729.000000) scale(0.100000,-0.100000)"
      fill="#000000" stroke="none">
      <path id='logo_s' class='type_1' d="M2810 5069 c-171 -20 -335 -79 -441 -159 -166 -125 -237 -286 -225
      -510 10 -184 51 -287 160 -396 111 -110 208 -149 526 -209 161 -30 231 -61
      254 -109 20 -42 20 -57 1 -102 -22 -54 -85 -78 -189 -72 -128 7 -176 44 -186
      142 l-5 51 -283 3 -282 2 2 -261 3 -262 80 -24 c378 -114 822 -143 1106 -72
      142 36 242 90 331 179 58 57 85 94 107 144 109 242 67 558 -97 724 -103 105
      -215 152 -486 207 -229 46 -273 60 -313 100 -58 58 -37 139 44 166 48 16 174
      7 207 -15 36 -23 57 -58 63 -106 l6 -40 263 0 264 0 0 240 0 240 -37 19 c-194
      97 -592 152 -873 120z"/>
      <path id='logo_q' class='type_1' d="M4475 5064 c-271 -49 -448 -253 -526 -604 -32 -147 -45 -369 -31
      -548 26 -326 104 -542 250 -689 131 -131 342 -194 547 -163 140 21 249 79 380
      202 l65 60 0 -206 0 -205 -117 -3 -118 -3 -3 -287 -2 -288 520 0 520 0 0 1065
      0 1065 75 0 75 0 0 285 0 285 -475 0 -475 0 0 -111 0 -111 -65 60 c-125 118
      -227 174 -355 198 -94 17 -163 16 -265 -2z m586 -630 c39 -20 77 -69 86 -112
      4 -20 8 -136 8 -257 0 -246 -5 -281 -42 -325 -39 -47 -79 -63 -154 -63 -83 0
      -136 27 -170 87 -24 40 -24 46 -24 301 0 254 1 261 23 301 39 66 110 97 202
      87 25 -3 57 -12 71 -19z"/>
      <path id='logo_u' class='type_1' d="M9264 5070 c-151 -11 -321 -34 -476 -65 -67 -14 -122 -25 -124 -25
      -2 0 -4 -144 -4 -320 0 -261 2 -320 13 -320 8 0 40 9 73 20 297 103 747 125
      859 43 27 -20 59 -74 69 -115 l6 -26 -98 -6 c-506 -33 -783 -140 -926 -358
      -134 -203 -107 -541 54 -698 105 -102 277 -157 456 -146 181 12 301 64 426
      186 l78 75 0 -107 0 -108 460 0 460 0 0 285 0 285 -74 0 -74 0 -4 408 c-4 380
      -6 412 -26 487 -79 291 -273 442 -638 495 -100 14 -370 20 -510 10z m403
      -1234 c-9 -125 -61 -206 -142 -224 -133 -29 -216 95 -141 210 30 47 137 83
      250 87 l39 1 -6 -74z"/>
      <path id='logo_a' class='type_1' d="M12051 5065 c-132 -25 -254 -104 -352 -228 l-39 -49 0 121 0 121
      -475 0 -475 0 0 -285 0 -285 75 0 75 0 -2 -392 -3 -393 -72 -3 -73 -3 0 -284
      0 -285 630 0 630 0 0 285 0 285 -155 0 -155 0 0 174 c0 269 29 377 126 466 54
      50 107 76 191 96 88 21 249 14 350 -15 40 -12 77 -21 83 -21 7 0 9 110 8 332
      l-3 332 -60 19 c-80 24 -212 30 -304 12z"/>
      <path id='logo_r' class='type_1' d="M13377 5068 c-370 -38 -652 -224 -781 -516 -55 -126 -78 -241 -83
      -427 -11 -357 58 -588 230 -771 137 -147 303 -233 545 -281 121 -24 442 -24
      602 1 146 22 353 75 450 115 41 17 76 31 78 31 1 0 2 127 2 281 l0 281 -22 -5
      c-13 -2 -69 -16 -124 -31 -201 -52 -522 -83 -678 -65 -159 17 -236 89 -236
      222 l0 37 560 0 560 0 0 133 c-1 265 -29 418 -105 572 -128 259 -334 391 -660
      424 -123 12 -211 12 -338 -1z m255 -500 c73 -22 118 -98 118 -200 l0 -48 -195
      0 -195 0 0 51 c0 136 63 206 189 208 24 1 61 -4 83 -11z"/>
      <path id='logo_e' class='type_1' d="M15250 5069 c-171 -20 -335 -79 -441 -159 -166 -125 -237 -286 -225
      -510 10 -184 51 -287 160 -396 111 -110 208 -149 526 -209 161 -30 231 -61
      254 -109 20 -42 20 -57 1 -102 -22 -54 -85 -78 -189 -72 -128 7 -176 44 -186
      142 l-5 51 -283 3 -282 2 2 -261 3 -262 80 -24 c378 -114 822 -143 1106 -72
      142 36 242 90 331 179 58 57 85 94 107 144 109 242 67 558 -97 724 -103 105
      -215 152 -486 207 -229 46 -273 60 -313 100 -58 58 -37 139 44 166 48 16 174
      7 207 -15 36 -23 57 -58 63 -106 l6 -40 263 0 264 0 0 240 0 240 -37 19 c-194
      97 -592 152 -873 120z"/>
      <path id='logo_s2' class='type_1' d="M6180 4745 l0 -285 75 0 75 0 0 -402 c0 -439 8 -540 54 -661 64 -170
      171 -271 341 -323 79 -24 271 -24 370 0 138 34 293 128 389 238 l46 53 0 -133
      0 -132 475 0 475 0 0 285 0 285 -75 0 -75 0 0 680 0 680 -495 0 -495 0 0 -285
      0 -285 96 0 95 0 -3 -322 c-3 -311 -4 -325 -26 -369 -31 -64 -84 -92 -171 -92
      -107 0 -170 47 -190 143 -7 34 -11 250 -11 630 l0 580 -475 0 -475 0 0 -285z"/>
      </g>


      </svg>
    </div>
    <svg class='board' id='gameboard' width = 500 height = 500 preserveAspectRatio="xMinYMin meet"></svg>
    <div id='non-board'>
      <div id='explain_panel'>
        <div id='explain_table' class='table'>
          <div id="explain_row" class='row'>
            <div id="explain_left" class="cell"></div>
            <div id="explain_right" class="cell"></div>
          </div>
        </div>
        <br/><hr/>
        <div id="explain_menu">
          Play
        </div>
      </div>
      <br/>
        <div id='info_bar'>
          <span id='daily_bar'></span>
          <span id='answer_bar'></span>
        </div>
      <br/>

      <div id='controls'>
          <div id="panel_left" class='panel'></div>
          <div id="panel_center" class='panel'></div>
          <div id="panel_right" class='panel'></div>
      </div>
        <div id='level_text'></div>

        <div id='rules'>
            <svg id='dots' width=100% height='100px'></svg>
        </div>


    </div>
  </div>




</body>

</html>